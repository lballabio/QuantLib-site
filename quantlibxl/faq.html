<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>QuantLibXL: Frequently Asked Questions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="tabs.css">
    <link rel="stylesheet" href="ql.css">
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
</head>
<body>
    <div id='wrapper'>
        <div id='header'>
        <div id='floatleft'><a class="imglink" href="index.html"><img src="images/logo_qlxl.jpg" width="180" height="72" border="0" alt="QuantLibXL Logo"/></a></div>
        <div id='floatright'><a class="imglink" href="http://quantlib.org"><img src="images/logo_ql.jpg" width="130" height="82" border="0" alt="QuantLib Logo"/></a></div>
        </div>
        <div id='content'>
            <div id='col-left'>
            <div id="version">Version 1.13.0</div>
                <div id='sidebar'>
<ul>
<li class="menuheader"><a href="index.html">Home</a></li>
<li><a href="installation.html">Download</a></li>
<li><a href="compile.html">Compile</a></li>
<li><a href="history.html">History</a></li>
<li><a href="license.html">License</a></li>
<li><a href="people.html">People</a></li>
<li><a href="faq.html">FAQ</a></li>
<li class="menuheader"><a href="functional.html">Functional<br>Documentation</a></li>
<li><a href="manual.html">Manual</a></li>
<li><a href="allfunctions.html">Functions</a></li>
<li><a href="categories.html">Categories</a></li>
<li><a href="enums.html">Enumerations</a></li>
<li><a href="framework.html">Framework</a></li>
</ul>
                </div>
<div class="logo">
<div class="vspace"></div>
<a href="http://www.reposit.be" id="reposit_logo"></a>
<div class="vspace"></div>
<a class="imglink" href="http://sourceforge.net"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=12470&amp;type=1" width="88" height="31" border="0" alt="SourceForge.net Logo"/></a>
<div class="vspace"></div>
</div>
            </div>
            <div id='col-right'>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Frequently Asked Questions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This is the FAQ for QuantLibAddin and QuantLibXL, which are subprojects of QuantLib. Please see also the <a href="http://quantlib.org/faq.shtml">general QuantLib FAQ</a> and the <a href="http://quantlib.org/developerFAQ.shtml">QuantLib developer FAQ</a>.</p>
<dl>
<dt><a class="el" href="faq.html#faq_section_general"><ol type="1">
<li>General</li>
</ol>
</a> </dt>
<dd><dl>
<dt><a class="el" href="faq.html#faq_item_whats_qla">1.1 What is QuantLibAddin?</a> </dt>
<dd></dd>
<dt><a class="el" href="faq.html#faq_item_whats_qlxl">1.2 What is QuantLibXL?</a> </dt>
<dd></dd>
<dt><a class="el" href="faq.html#faq_item_help">1.3 Where do I go for help?</a> </dt>
<dd></dd>
</dl>
</dd>
<dt><a class="el" href="faq.html#faq_sec_installation"><ol type="1">
<li>Installation</li>
</ol>
</a> </dt>
<dd><dl>
<dt><a class="el" href="faq.html#faq_item_installation">2.1 How do I compile and/or install QuantLibAddin/QuantLibXL?</a> </dt>
<dd></dd>
</dl>
</dd>
<dt><a class="el" href="faq.html#faq_sec_compilation"><ol type="1">
<li>Compilation</li>
</ol>
</a> </dt>
<dd><dl>
<dt><a class="el" href="faq.html#faq_item_winheader">3.1 Why does my compilation fail with an error message about windows.h?</a> </dt>
<dd></dd>
</dl>
</dd>
<dt><a class="el" href="faq.html#faq_sec_usage"><ol type="1">
<li>Usage</li>
</ol>
</a> </dt>
<dd><dl>
<dt><a class="el" href="faq.html#faq_item_start">4.1 How do I start QuantLibXL?</a> </dt>
<dd></dd>
<dt><a class="el" href="faq.html#faq_item_vba">4.2 How do I call QuantLibXL functions from Excel VBA?</a> </dt>
<dd></dd>
<dt><a class="el" href="faq.html#faq_item_numparams">4.3 What is the maximum number of arguments for a QuantLibXL function?</a> </dt>
<dd></dd>
<dt><a class="el" href="faq.html#faq_item_hashnum">4.4 What do I do if a QuantLibXL function returns #NUM?</a> </dt>
<dd></dd>
<dt><a class="el" href="faq.html#faq_item_errorstring">4.5 Why don't QuantLibXL functions just return the error message string instead of #NUM?</a> </dt>
<dd></dd>
</dl>
</dd>
<dt><a class="el" href="faq.html#faq_sec_troubleshooting"><ol type="1">
<li>Troubleshooting</li>
</ol>
</a> </dt>
<dd><dl>
<dt><a class="el" href="faq.html#faq_item_startup">5.1 Why does Excel display an error message when I load QuantLibXL?</a> </dt>
<dd></dd>
<dt><a class="el" href="faq.html#faq_item_wizard">5.2 Why does Excel crash when I use the Function Wizard?</a> </dt>
<dd></dd>
</dl>
</dd>
<dt><a class="el" href="faq.html#faq_sec_debugging"><ol type="1">
<li>Debugging</li>
</ol>
</a> </dt>
<dd><dl>
<dt><a class="el" href="faq.html#faq_item_debugexcel">6.1 How do I debug QuantLibXL?</a> </dt>
<dd></dd>
<dt><a class="el" href="faq.html#faq_item_debuglinux">6.2 How do I debug a QuantLibAddin Linux executable at the command line?</a> </dt>
<dd></dd>
</dl>
</dd>
</dl>
<h1><a class="anchor" id="faq_section_general"></a>
1. General</h1>
<h2><a class="anchor" id="faq_item_whats_qla"></a>
1.1 What is QuantLibAddin?</h2>
<p>QuantLibAddin is an interface allowing <a href="http://quantlib.org">QuantLib</a> (an open source analytics library for quantitative finance) to be deployed to end user environments such as spreadsheets.</p>
<h3>QuantLib</h3>
<p>QuantLib is a static library of classes. Before it can be deployed to an end user, it must be wrapped in an application layer - a command line executable, a spreadsheet addin, a webserver application.</p>
<h3>ObjectHandler</h3>
<p>A function of the application layer is to provide a mechanism for storing QuantLib objects once they are created. Spreadsheets do not provide such a mechanism so one must be implemented by the addin. QuantLibAddin uses <a href="http://www.objecthandler.org">ObjectHandler</a> as its object repository. The core of QuantLibAddin is a library called QuantLibObjects, which wraps QuantLib objects in a form that allows them to be stored in the ObjectHandler repository.</p>
<h3>QuantLibAddin</h3>
<p>Additionally QuantLibAddin implements an interface, a library of functions, which the end user invokes to access the underlying QuantLib objects. For example on a spreadsheet when the user enters formula qlPiecewiseYieldCurve() into a cell, a QuantLib yield curve is instantiated in the ObjectHandler repository and a reference to that object is returned to the calling cell. QuantLibAddin supports this interface on a variety of end user platforms such as Microsoft Excel and OpenOffice.org Calc.</p>
<h2><a class="anchor" id="faq_item_whats_qlxl"></a>
1.2 What is QuantLibXL?</h2>
<p>QuantLibXL is the Excel implementation of the QuantLibAddin interface. QuantLibXL is an Excel Addin, a C++ binary in the XLL format, allowing QuantLib functions to be accessed from cell formulas.</p>
<h2><a class="anchor" id="faq_item_help"></a>
1.3 Where do I go for help?</h2>
<p>The mailing list for this project is <a href="https://lists.sourceforge.net/lists/listinfo/quantlib-users">quantlib-users@lists.sf.net</a>. The list archives may be searched <a href="http://sourceforge.net/search/?group_id=12740&amp;type_of_search=mlists">here</a>.</p>
<p>QuantLibAddin is the product of collaboration from many volunteers. Not all of them follow the mailing list and some questions go unanswered, sorry about that. Try writing in Italian ;-)</p>
<h1><a class="anchor" id="faq_sec_installation"></a>
2. Installation</h1>
<h2><a class="anchor" id="faq_item_installation"></a>
2.1 How do I compile and/or install QuantLibAddin/QuantLibXL?</h2>
<ul>
<li>If you want an installer delivering a compiled QuantLibXL Addin and documentation for use with Microsoft Excel, visit <a href="http://www.quantlibxl.org">www.quantlibxl.org</a>. </li>
<li>If you want to compile QuantLibAddin/QuantLibXL from source code for Excel or other platforms, visit <a href="http://www.quantlibaddin.org/tutorials.html">http://www.quantlibaddin.org/tutorials.html</a>.</li>
</ul>
<h1><a class="anchor" id="faq_sec_compilation"></a>
3. Compilation</h1>
<h2><a class="anchor" id="faq_item_winheader"></a>
3.1 Why does my compilation fail with an error message about windows.h?</h2>
<pre class="fragment">fatal error C1083: Cannot open include file: 'windows.h':
    No such file or directory
</pre><p>You need to install the Platform SDK as explained in the documentation for Visual Studio Express.</p>
<h1><a class="anchor" id="faq_sec_usage"></a>
4. Usage</h1>
<h2><a class="anchor" id="faq_item_start"></a>
4.1 How do I start QuantLibXL?</h2>
<p>See <a href="http://www.quantlibxl.org/installation.html">http://www.quantlibxl.org/installation.html</a>.</p>
<h2><a class="anchor" id="faq_item_vba"></a>
4.2 How do I call QuantLibXL functions from Excel VBA?</h2>
<p>QuantLibXL can be invoked from VBA using Application.Run(). For example, below is a subroutine which calculates the price of an option. This code mimics the behavior of example spreadsheet <code>QuantLibXL\Workbooks\StandaloneExamples\Options.xls</code>.</p>
<pre class="fragment">Sub priceEuropeanOption()

On Error GoTo Catch

    Dim blackVolId As String
    Dim blackScholesId As String
    Dim exerciseId As String
    Dim payoffId As String
    Dim engineId As String
    Dim optionId As String
    Dim npv As Double

    Call Application.Run("qlSettingsSetEvaluationDate", 35930)

    blackVolId = Application.Run("qlBlackConstantVol", _
        "blackConstantVol", 35932, "Target", 0.2, "Actual/365 (Fixed)")
    blackScholesId = Application.Run( _
        "qlGeneralizedBlackScholesProcess", "blackScholes", _
        blackVolId, 36, "Actual/365 (Fixed)", 35932, 0.06, 0)
    exerciseId = Application.Run("qlEuropeanExercise", _
        "europeanExercise", 36297)
    payoffId = Application.Run("qlStrikedTypePayoff", _
        "strikedTypePayoff", "Vanilla", "Put", 40)
    engineId = Application.Run("qlPricingEngine", _
        "pricingEngine", "AE", blackScholesId)
    optionId = Application.Run("qlVanillaOption", _
        "vanillaOption", payoffId, exerciseId)

    Call Application.Run("qlInstrumentSetPricingEngine", _
        optionId, engineId)
    npv = Application.Run("qlInstrumentNPV", optionId)

    Debug.Print "NPV = " &amp; npv

    Exit Sub

Catch:

Debug.Print "QuantLibXL Error: " + Err.Description
MsgBox Err.Description, vbCritical, "QuantLibXL Error"

End Sub
</pre><h2><a class="anchor" id="faq_item_numparams"></a>
4.3 What is the maximum number of arguments for a QuantLibXL function?</h2>
<p>Twenty.</p>
<p>Excel versions up to and including 2003 have a limit of 30 function arguments. But there is an effective limit of 20 arguments for user defined functions. This is because the function is registered with a call to xlfRegister, which is itself limited to 30 arguments. xlfRegister uses 10 of its arguments to register the function, leaving 20 slots for the descriptions of the arguments to your addin function.</p>
<p>It is in fact possible to register a user defined function with up to 30 arguments, by omitting descriptions for arguments beyond the 20th. The 21st and later arguments are valid but appear in the Function Wizard with no descriptions. An attempt was made to support this trick in QuantLibXL but at present the implementation is not functional because of a bug.</p>
<p>Excel 2007 introduces support for user defined functions with up to 255 arguments but QuantLibXL has not yet been upgraded to take advantage of this.</p>
<h2><a class="anchor" id="faq_item_hashnum"></a>
4.4 What do I do if a QuantLibXL function returns #NUM?</h2>
<p>Call <code>ohRangeRetrieveError()</code>.</p>
<p>When a QuantLibXL function returns #NUM, this indicates an application-level error within QuantLib (as opposed to, say, an input of the wrong type, which is captured by Excel itself and indicated with #VALUE). Enter <code>ohRangeRetrieveError()</code> into another cell, take the range containing the QuantLibXL function that returned #NUM and pass that as input into <code>ohRangeRetrieveError()</code>, and <code>ohRangeRetrieveError()</code> returns the actual error message string generated by QuantLib.</p>
<p>The QuantLibXL Framework includes VBA code which allows you to right-click on a cell containing #NUM in order to see the error. There is also a feature allowing you to select the cell containing #NUM and hit Ctrl-Shift-E to see the error message. These routines call <code>ohRangeRetrieveError()</code> behind the scenes, saving you the hassle of manually entering that function into another cell.</p>
<p>If you enable logging and call <code>ohRepositoryLogAllObjects()</code> you will get a list of all QuantLib error messages associated with all of the ranges containing #NUM in the active Excel session.</p>
<h2><a class="anchor" id="faq_item_errorstring"></a>
4.5 Why don't QuantLibXL functions just return the error message string instead of #NUM?</h2>
<p>Because such a design would subvert Excel's error handling mechanism.</p>
<p>The design of Excel assumes that worksheet functions indicate errors with #NUM, #REF, etc. The absence of those codes is interpreted by Excel to mean that the function completed successfully. If the return value of one function is passed as input to another, and if the first function returns an error, Excel doesn't call the second function, instead it sets the second function to #REF.</p>
<p>Suppose function 1 returns the ID of an object, e.g. "swap1", and this is passed as input to function 2, which retrieves "swap1" and does something with it. Suppose function 1 fails, and instead of returning #NUM, it returns the actual error message, e.g. "Could not create object!". Function 2 does not know that function 1 has failed, and attempts to retrieve an object called "Could not create object!", with the failure of that operation leading to further confusion. Returning #NUM in case of error respects Excel's native error handling mechanism.</p>
<h1><a class="anchor" id="faq_sec_troubleshooting"></a>
5. Troubleshooting</h1>
<h2><a class="anchor" id="faq_item_startup"></a>
5.1 Why does Excel display an error message when I load QuantLibXL?</h2>
<p>When you try to load an XLL into Excel, you may get a warning message such as "This file is not in a recognizable format" or "XYZ.XLL is
not a valid add-in". Excel may attempt to load the XLL as a text file. These errors indicate that the XLL has a runtime dependency which is not satisfied.</p>
<p>If you compiled your XLL on one machine, and are trying to use it on another, ensure that the runtime library is present on the target machine. For example an XLL compiled in VC8 using configuration <code>Release</code> has a runtime dependency on files <code>MSVCP80.DLL</code> and <code>MSVCR80.DLL</code>.</p>
<p>If you used <code>QuantLibAllDynamic_vc?.sln</code> to compile ObjectHandler and QuantLibXL as separate, dynamically linked XLLs, note that the ObjectHandler XLL must be loaded into Excel before QuantLibXL.</p>
<p>Microsoft Visual C++ includes the utility <code>DEPENDS.EXE</code> which can be used to identify the runtime dependencies of a binary.</p>
<h2><a class="anchor" id="faq_item_wizard"></a>
5.2 Why does Excel crash when I use the Function Wizard?</h2>
<p>The Function Wizard (launched by clicking the <code>fx</code> button next to the Formula Bar) allows the user to specify function inputs by clicking in selected cell ranges. The Function Wizard calls the underlying cell formula repeatedly every time the inputs change - so the formula will get invoked repeatedly with incomplete or nonsensical inputs. Any bug in the validation of the inputs may cause the formula to malfunction or crash. Try calling the function without using the Function Wizard - for example, format the call to the function in Notepad, and paste the formula directly into a cell.</p>
<p>It is possible for an Excel Addin function to detect whether it has been called from the Function Wizard. Certain QuantLibXL functions perform this test, exiting immediately with a return value of null if the Function Wizard is detected. Such functions are configured with tag <code>calcInWizard='false'</code> in the XML metadata (<code>QuantLibAddin\gensrc\metadata\functions</code>). The test is expensive and its use is discouraged. Unfortunately QuantLibXL may contain functions which do not perform the test and which crash when invoked from the Function Wizard.</p>
<h1><a class="anchor" id="faq_sec_debugging"></a>
6. Debugging</h1>
<h2><a class="anchor" id="faq_item_debugexcel"></a>
6.1 How do I debug QuantLibXL?</h2>
<ul>
<li>compile QuantLibXL with the Debug configuration </li>
<li>start Excel and load QuantLibXL and a client worksheet </li>
<li>Go into Microsoft Visual Studio </li>
<li>do <code>Build | Debug | Attach to Process</code> </li>
<li>Select Excel from the list of processes. </li>
<li>From VC, open up a file containing the source code you'd like to debug - for example file <code>QuantLibXL\qlxl\Functions\volatilities.cpp</code> </li>
<li>Identify a function you'd like to debug, for example <code>qlBlackConstantVol()</code>. Put the cursor on a line in the function and hit F9 to set a breakpoint on the line </li>
<li>Back in Excel, trigger the breakpoint - select the cell containing the relevant formula, e.g. <code>qlBlackConstantVol()</code>, hit F2 to force the cell to recalc </li>
<li>Back in VC, execution should now be stopped on the breakpoint and you can debug from there, e.g.<br />
 F10 - advance a line<br />
 F11 - step into a function<br />
F5 - run until the next breakpoint or until completion<br />
 etc.</li>
</ul>
<h2><a class="anchor" id="faq_item_debuglinux"></a>
6.2 How do I debug a QuantLibAddin Linux executable at the command line?</h2>
<p>This section describes how to debug a standalone C++ QuantLibAddin client linux program with the <code>gdb</code> command line debugger, using program <code>QuantLibAddin/Clients/C++/QLADemo</code> as an example.</p>
<h3>Compiling for Debug</h3>
<p>By default QuantLibAddin compiles with flags <code>-g -O2</code> which is good for general purpose use but does not give ideal results in gdb: </p><ul>
<li>certain variables get optimized away - so you're looking at a line in the source code, but it's invisible to the debugger </li>
<li>the debugger may step into the source code of the Standard Template Library, even if you try to tell it not to</li>
</ul>
<p>gdb performs better when run against programs which are compiled with flag <code>-gdwarf-2</code>. So before debugging the QuantLibAddin executable, it's best to first reconfigure and recompile all relevant binaries - QuantLib, log4cxx, ObjectHandler, and QuantLibAddin. cd to the top level directory for each project and run configure with the appropriate flag: </p><pre class="fragment">./configure CXXFLAGS=-gdwarf-2
</pre><p> Then recompile.</p>
<h3>The Executable</h3>
<p>The program we want to debug is QLADemo. File <code>QuantLibAddin/Clients/C++/QLADemo</code> is a shell script wrapper for the underlying executable <code>QuantLibAddin/Clients/C++/.libs/lt-QLADemo</code> which is created the first time the wrapper is invoked. So run the wrapper once to create the executable, then cd into the .libs directory.</p>
<p>(Or maybe you can do </p><div class="fragment"><div class="line">libtool --mode=execute gdb QLADemo</div></div><!-- fragment --><p> ?)</p>
<h3>Debugging</h3>
<p>Now you can debug the program in the usual way e.g.</p>
<ul>
<li><code>gdb lt-QLADemo</code> - to start the debugger </li>
<li><code>b(reak) main</code> - to set a breakpoint in function <code>main</code> </li>
<li><code>r(un)</code> - to start the program </li>
<li><code>l(ist)</code> - to list lines of code surrounding the breakpoint </li>
<li><code>n(ext)</code> - to advance to the next line </li>
<li><code>s(tep)</code> - to step into a function </li>
<li><code>c(ontinue)</code> - to continue to another breakpoint </li>
<li><code>p(rint)</code> - to display a variable's value</li>
</ul>
<p>etc. </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
            </div>
            <div class='clearfix'></div>
<div id="footer">SourceForge logo copyright &#169; Open Source Technology Group<br>reposit logo <a href="http://www.reposit.be">copyright &#169; 2015 reposit Ltd Dublin</a><br>all other content <a href="license.html">copyright &#169; 2004-20015 The QuantLib Group</a></div>
        </div>
        <div class='clearfix'></div>
    </div>
    <div class='clearfix'></div>
</body>
</html>
