<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>QuantLibAddin: Design</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="tabs.css">
    <link rel="stylesheet" href="ql.css">
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
</head>
<body>
    <div id='wrapper'>
        <div id='header'>
        <div id='floatleft'><a class="imglink" href="index.html"><img src="images/logo_qla.jpg" width="180" height="72" border="0" alt="QuantLibAddin Logo"/></a></div>
        <div id='floatright'><a class="imglink" href="http://quantlib.org"><img src="images/logo_ql.jpg" width="130" height="82" border="0" alt="QuantLib Logo"/></a></div>
        </div>
        <div id='content'>
            <div id='col-left'>
            <div id="version">Version 1.20.0</div>
                <div id='sidebar'>
<ul>
<li class="menuheader"><a href="index.html">Home</a></li>
<li><a href="installation.html">Installation</a></li>
<li><a href="design.html">Design</a></li>
<li><a href="history.html">History</a></li>
<li><a href="license.html">License</a></li>
<li><a href="people.html">People</a></li>
<li><a href="faq.html">FAQ</a></li>
<li class="menuheader"><a href="functional.html">Functional<br>Documentation</a></li>
<li><a href="manual.html">Manual</a></li>
<li><a href="allfunctions.html">Functions</a></li>
<li><a href="categories.html">Categories</a></li>
<li><a href="enums.html">Enumerations</a></li>
<li class="menuheader"><a href="technical.html">Technical<br>Documentation</a></li>
<li><a href="tutorials.html">Tutorials</a></li>
<li><a href="annotated.html">Classes</a></li>
<li><a href="hierarchy.html">Hierarchy</a></li>
<li><a href="files.html">Files</a></li>
<li><a href="examples.html">Examples</a></li>
</ul>
                </div>
<div class="logo">
<div class="vspace"></div>
<a href="http://www.reposit.be" id="reposit_logo"></a>
<div class="vspace"></div>
<a class="imglink" href="http://sourceforge.net"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=12470&amp;type=1" width="88" height="31" border="0" alt="SourceForge.net Logo"/></a>
<div class="vspace"></div>
</div>
            </div>
            <div id='col-right'>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Design </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><table border="1" bgcolor="lightsteelblue">
<tr>
<td><b>NB:</b> This document is out of date. The QuantLibAddin implementation still reflects the high-level ideas in this document but many of the details have changed. For further information please refer to the QuantLibAddin source code or send email to <a href="#" onclick="location.href='mai'+'lto:'+'qua'+'nt'+'lib'+'-u'+'ser'+'s@'+'lis'+'ts'+'.sf'+'.n'+'et'; return false;">quant<span style="display: none;">.nosp@m.</span>lib-<span style="display: none;">.nosp@m.</span>users<span style="display: none;">.nosp@m.</span>@lis<span style="display: none;">.nosp@m.</span>ts.sf<span style="display: none;">.nosp@m.</span>.net</a>.  </td></tr>
</table>
<h2>Abstract</h2>
<p>QuantLibAddin implements an interface supporting a subset of QuantLib functionality. Constructor, member and utility functions are defined in XML metadata from which a Python application generates source code for supported platforms. The ObjectHandler repository is used to provide an object oriented environment even on procedural platforms such as spreadsheets - QuantLib objects may be constructed, interrogated, passed as arguments to other functions, and destructed. Polymorphism is supported, for example function qlNPV returns the NPV of an Instrument and can be invoked on an instance of any derived class - Swap, Bond, etc.</p>
<p><a class="anchor" id="tag_contents"></a></p><h2>Contents</h2>
<dl>
<dt><a class="el" href="design.html#sec_1"><ol type="1">
<li>Design</li>
</ol>
</a> </dt>
<dd><dl>
<dt><a class="el" href="design.html#sec_1_1">1.1 Classes</a> </dt>
<dd></dd>
<dt><a class="el" href="design.html#sec_1_2">1.2 Addins</a> </dt>
<dd></dd>
<dt><a class="el" href="design.html#sec_1_3">1.3 Clients</a> </dt>
<dd></dd>
</dl>
</dd>
<dt><a class="el" href="design.html#sec_2">2 Implementation</a> </dt>
<dd><dl>
<dt><a class="el" href="design.html#sec_2_1">2.1 Classes</a> </dt>
<dd></dd>
<dt><a class="el" href="design.html#sec_2_2">2.2 Addins</a> </dt>
<dd></dd>
<dt><a class="el" href="design.html#sec_2_3">2.3 Clients</a> </dt>
<dd><dl>
<dt><a class="el" href="design.html#sec_2_3_1">2.3.1 C++</a> </dt>
<dd></dd>
<dt><a class="el" href="design.html#sec_2_3_2">2.3.2 Excel</a> </dt>
<dd></dd>
</dl>
</dd>
</dl>
</dd>
<dt><a class="el" href="design.html#sec_3"><ol type="1">
<li>Autogeneration</li>
</ol>
</a> </dt>
<dd></dd>
</dl>
<h1><a class="anchor" id="sec_1"></a>
1. Design</h1>
<div class="center"><img src="images/design.jpg" alt="" class="inline"/></div> <p>QuantLibAddin uses ObjectHandler to allow the user to build up a repository of QuantLib objects. Each QuantLib class to be available in QuantLibAddin is wrapped in a class descended from Object.</p>
<p>The core QuantLibAddin library can be loaded directly into standalone C++ programs. For other platforms, QuantLibAddin is wrapped in an additional layer providing platform-specific functionality. QuantLibAddin has the same interface on all platforms.</p>
<h1><a class="anchor" id="sec_1_1"></a>
1.1 Classes</h1>
<p>The class for each QuantLib object to be stored in ObjectHandler is wrapped in a class derived from <code>Object</code>. The constructor of the derived Object class calls the constructor of the corresponding QuantLib class, and the resulting QuantLib object is stored as a member variable of the derived Object. The Propery vector in the base Object class is populated appropriately.</p>
<h1><a class="anchor" id="sec_1_2"></a>
1.2 Addins</h1>
<p>The core QuantLibAddin binary can be linked directly into end-user C++ applications. For other platforms, QuantLibAddin is linked into a platform-specific library which:</p>
<ul>
<li>
retrieves inputs in native format from host application </li>
<li>
converts inputs to QuantLib format </li>
<li>
invokes the QuantLibAddin function and captures its return value </li>
<li>
converts the return value to native format and returns it to the host application </li>
</ul>
<p>The above is wrapped in try/catch. All Addins use standard calls to log exceptions to the QuantLibAddin log file, and may perform addition platform-specific error handling e.g. throwing a new exception for the host application.</p>
<h1><a class="anchor" id="sec_1_3"></a>
1.3 Clients</h1>
<p>The client application loads QuantLibAddin, instantiating a single global instance of ObjectHandler. QuantLibAddin functions allow objects to be constructed, interrogated, modified, and passed as input parameters to constructors / member functions of other objects. Objects can be deleted explicitly, otherwise ObjectHandler destroys all objects in its repository when it is destroyed.</p>
<h1><a class="anchor" id="sec_2"></a>
2 Implementation</h1>
<p>The example below illustrates an implementation of QuantLibAddin and clients, including three QuantLibAddin functions which</p>
<ul>
<li>
construct a BlackScholesProcess from native datatypes </li>
<li>
construct a VanillaOption from the BlackScholesProcess and native datatypes </li>
<li>
change the Pricing Engine of the VanillaOption. </li>
</ul>
<p>The example demonstrates how objects may be created, passed as inputs to constructors of other objects, manipulated, and destroyed. The example includes pseudocode, the latest development code can be checked out from the <a href="http://quantlib.org/cvs.shtml">QuantLib CVS repository</a> (module QuantLibAddin) or browsed <a href="http://cvs.sourceforge.net/viewcvs.py/quantlib/QuantLibAddin/">on line</a>.</p>
<h1><a class="anchor" id="sec_2_1"></a>
2.1 Classes</h1>
<h4>qla/processes.hpp</h4>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code" href="namespace_quant_lib_addin.html">QuantLibAddin</a> {</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">class </span>BlackScholesProcess : <span class="keyword">public</span> ObjHandler::Object {</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line"> </div>
<div class="line">        BlackScholesProcess(</div>
<div class="line">            <span class="keyword">const</span> std::string &amp;handleBlackVol,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;underlying,</div>
<div class="line">            <span class="keyword">const</span> std::string &amp;dayCounterID,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">long</span> &amp;settlementDateLong,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;riskFreeRate,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;dividendYield);</div>
<div class="line">        <span class="keyword">virtual</span> boost::shared_ptr&lt;void&gt; getReference()<span class="keyword"> const </span>{</div>
<div class="line">            <span class="keywordflow">return</span> boost::static_pointer_cast&lt;void&gt;(blackScholesProcess_);</div>
<div class="line">        }</div>
<div class="line">    <span class="keyword">private</span>:</div>
<div class="line">        boost::shared_ptr&lt;QuantLib::BlackScholesProcess&gt;</div>
<div class="line">            blackScholesProcess_;</div>
<div class="line">    };</div>
<div class="line">}</div>
</div><!-- fragment --><h4>qla/processes.cpp</h4>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code" href="namespace_quant_lib_addin.html">QuantLibAddin</a> {</div>
<div class="line"> </div>
<div class="line">    BlackScholesProcess::BlackScholesProcess(</div>
<div class="line">            <span class="keyword">const</span> std::string &amp;handleBlackVol,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;underlying,</div>
<div class="line">            <span class="keyword">const</span> std::string &amp;dayCounterID,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">long</span> &amp;settlementDateLong,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;riskFreeRate,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;dividendYield) {</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// convert input values to QuantLib datatypes</span></div>
<div class="line">        ...</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="comment">// retrieve BlackVolTermStructure from ObjectHandler</span></div>
<div class="line"> </div>
<div class="line">        boost::shared_ptr&lt;BlackVolTermStructure&gt; blackVolTermStructure =</div>
<div class="line">            OH_GET_OBJECT(BlackVolTermStructure, handleBlackVol);</div>
<div class="line">        boost::shared_ptr&lt;QuantLib::BlackVolTermStructure&gt;</div>
<div class="line">            blackVolTermStructureP = OH_GET_REFERENCE(</div>
<div class="line">                QuantLib::BlackVolTermStructure,</div>
<div class="line">                blackVolTermStructure);</div>
<div class="line">        <a class="code" href="class_quant_lib_1_1_handle.html">QuantLib::Handle&lt;QuantLib::BlackVolTermStructure&gt;</a></div>
<div class="line">            blackVolTermStructureH(blackVolTermStructureP);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// construct new BlackScholesProcess object</span></div>
<div class="line"> </div>
<div class="line">        blackScholesProcess_ =</div>
<div class="line">            boost::shared_ptr&lt;QuantLib::BlackScholesProcess&gt;(</div>
<div class="line">                <span class="keyword">new</span> QuantLib::BlackScholesProcess(</div>
<div class="line">                    underlyingH,</div>
<div class="line">                    flatDividendTS,</div>
<div class="line">                    flatTermStructure,</div>
<div class="line">                    blackVolTermStructureH));</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><h4>qla/vanillaoption.hpp</h4>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code" href="namespace_quant_lib_addin.html">QuantLibAddin</a> {</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">class </span>VanillaOption : <span class="keyword">public</span> Instrument {</div>
<div class="line">    <span class="keyword">public</span>:</div>
<div class="line">        <a class="code" href="class_quant_lib_addin_1_1_vanilla_option.html#a3d7b03456bd54178a66968788f424772">VanillaOption</a>(</div>
<div class="line">            <span class="keyword">const</span> std::string &amp;handleBlackScholes,</div>
<div class="line">            <span class="keyword">const</span> std::string &amp;optionTypeID,</div>
<div class="line">            <span class="keyword">const</span> std::string &amp;payoffID,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;strike,</div>
<div class="line">            <span class="keyword">const</span> std::string &amp;exerciseID,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">long</span> &amp;exerciseDate,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">long</span> &amp;settlementDate,</div>
<div class="line">            <span class="keyword">const</span> std::string &amp;engineID,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">long</span> &amp;timeSteps);</div>
<div class="line">        std::string setEngine(</div>
<div class="line">            <span class="keyword">const</span> std::string &amp;engineName,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">long</span> &amp;timeSteps);</div>
<div class="line">    };</div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><h4>qla/vanillaoption.cpp</h4>
<div class="fragment"><div class="line"><span class="keyword">namespace </span><a class="code" href="namespace_quant_lib_addin.html">QuantLibAddin</a> {</div>
<div class="line"> </div>
<div class="line">    <a class="code" href="class_quant_lib_addin_1_1_vanilla_option.html#a3d7b03456bd54178a66968788f424772">VanillaOption::VanillaOption</a>(</div>
<div class="line">            <span class="keyword">const</span> std::string &amp;handleBlackScholes,</div>
<div class="line">            <span class="keyword">const</span> std::string &amp;optionTypeID,</div>
<div class="line">            <span class="keyword">const</span> std::string &amp;payoffID,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">double</span> &amp;strike,</div>
<div class="line">            <span class="keyword">const</span> std::string &amp;exerciseID,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">long</span> &amp;exerciseDate,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">long</span> &amp;settlementDate,</div>
<div class="line">            <span class="keyword">const</span> std::string &amp;engineID,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">long</span> &amp;timeSteps) {</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// retrieve BlackVolTermStructure from ObjectHandler</span></div>
<div class="line"> </div>
<div class="line">        boost::shared_ptr&lt;BlackScholesProcess&gt; blackScholesProcess =</div>
<div class="line">            OH_GET_OBJECT(BlackScholesProcess, handleBlackScholes);</div>
<div class="line">        <span class="keyword">const</span> boost::shared_ptr&lt;QuantLib::BlackScholesProcess&gt;</div>
<div class="line">            blackScholesProcessQL = OH_GET_REFERENCE(</div>
<div class="line">                QuantLib::BlackScholesProcess,</div>
<div class="line">                blackScholesProcess);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// format inputs to QuantLib::VanillaOption constructor</span></div>
<div class="line">        ...</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// construct new VanillaOption object</span></div>
<div class="line"> </div>
<div class="line">        mInstrument = boost::shared_ptr&lt;QuantLib::VanillaOption&gt;(</div>
<div class="line">            <span class="keyword">new</span> QuantLib::VanillaOption(</div>
<div class="line">                blackScholesProcessQL,</div>
<div class="line">                payoff,</div>
<div class="line">                exercise,</div>
<div class="line">                pricingEngine));</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// populate object&#39;s property vector</span></div>
<div class="line"> </div>
<div class="line">        createProperty(FIELD_NPV, mInstrument-&gt;NPV());</div>
<div class="line">        createProperty(FIELD_ENGINE, engineID);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    std::string VanillaOption::setEngine(</div>
<div class="line">            <span class="keyword">const</span> std::string &amp;engineID,</div>
<div class="line">            <span class="keyword">const</span> <span class="keywordtype">long</span> &amp;timeSteps) {</div>
<div class="line">        boost::shared_ptr&lt;QuantLib::PricingEngine&gt; pricingEngine =</div>
<div class="line">            Create&lt;boost::shared_ptr&lt;QuantLib::PricingEngine&gt; &gt;()(</div>
<div class="line">                engineID, timeSteps);</div>
<div class="line">        mInstrument-&gt;setPricingEngine(pricingEngine);</div>
<div class="line">        updateProperty(IDX_NPV, mInstrument-&gt;NPV());</div>
<div class="line">        updateProperty(IDX_ENGINE, engineID);</div>
<div class="line">        <span class="keywordflow">return</span> engineID;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="sec_2_2"></a>
2.2 Addins</h1>
<p>The QuantLibAddin library can be linked directly into an end-user C++ application. For other platforms, QuantLibAddin is wrapped in a further addin providing platform specific functionality. Below is the code for an Excel addin function.</p>
<h4>Addins/Excel/options.cpp</h4>
<div class="fragment"><div class="line">DLLEXPORT <span class="keywordtype">char</span> *qlVanillaOption(</div>
<div class="line">        <span class="keywordtype">char</span> *handle,</div>
<div class="line">        <span class="keywordtype">char</span> *handleBlackScholes,</div>
<div class="line">        <span class="keywordtype">char</span> *optionType,</div>
<div class="line">        <span class="keywordtype">char</span> *payoff,</div>
<div class="line">        <span class="keywordtype">double</span> *strike,</div>
<div class="line">        <span class="keywordtype">char</span> *exercise,</div>
<div class="line">        <span class="keywordtype">long</span> *exerciseDate,</div>
<div class="line">        <span class="keywordtype">long</span> *settlementDate,</div>
<div class="line">        <span class="keywordtype">char</span> *engine,</div>
<div class="line">        <span class="keywordtype">long</span> *timeSteps) {</div>
<div class="line">    ObjHandler::obj_ptr objectPointer(<span class="keyword">new</span> <a class="code" href="class_quant_lib_addin_1_1_vanilla_option.html">QuantLibAddin::VanillaOption</a>(</div>
<div class="line">        handleBlackScholes,</div>
<div class="line">        optionType,</div>
<div class="line">        payoff,</div>
<div class="line">        *strike,</div>
<div class="line">        exercise,</div>
<div class="line">        *exerciseDate,</div>
<div class="line">        *settlementDate,</div>
<div class="line">        engine,</div>
<div class="line">        *timeSteps));</div>
<div class="line"> </div>
<div class="line">    std::string returnValue =</div>
<div class="line">        ObjHandler::storeObject(handle, objectPointer);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">char</span> ret[XL_MAX_STR_LEN];</div>
<div class="line">    ObjHandler::stringToChar(ret, returnValue);</div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">DLLEXPORT <span class="keywordtype">char</span> *qlOptionSetEngine(</div>
<div class="line">        <span class="keywordtype">char</span> *handle,</div>
<div class="line">        <span class="keywordtype">char</span> *engineName,</div>
<div class="line">        <span class="keywordtype">long</span> *timeSteps) {</div>
<div class="line">    boost::shared_ptr &lt; QuantLibAddin::VanillaOption &gt; objectPointer =</div>
<div class="line">        OH_GET_OBJECT(<a class="code" href="class_quant_lib_addin_1_1_vanilla_option.html">QuantLibAddin::VanillaOption</a>, handle);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> std::string returnValue;</div>
<div class="line">    returnValue = objectPointer-&gt;setEngine(</div>
<div class="line">        engineName,</div>
<div class="line">        *timeSteps);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">static</span> <span class="keywordtype">char</span> ret[XL_MAX_STR_LEN];</div>
<div class="line">    ObjHandler::stringToChar(ret, returnValue);</div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
</div><!-- fragment --> <h1><a class="anchor" id="sec_2_3"></a>
2.3 Clients</h1>
<h1><a class="anchor" id="sec_2_3_1"></a>
2.3.1 C++</h1>
<p>Example of a standalone C++ client application.</p>
<h4>Clients/C++/qlademo.cpp</h4>
<div class="fragment"><div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="keywordtype">double</span> dividendYield = 0.00;</div>
<div class="line">    <span class="keywordtype">double</span> riskFreeRate = 0.06;</div>
<div class="line">    <span class="keywordtype">double</span> volatility = 0.20;</div>
<div class="line">    <span class="keywordtype">double</span> underlying = 36;</div>
<div class="line">    <span class="keywordtype">double</span> strike = 40;</div>
<div class="line">    <span class="keywordtype">long</span> timeSteps = 801;</div>
<div class="line">    Date exerciseDate(13, March, 2020);</div>
<div class="line">    Date settlementDate(13, March, 2019);</div>
<div class="line"> </div>
<div class="line">    obj_ptr blackConstantVol(<span class="keyword">new</span> <a class="code" href="class_quant_lib_addin_1_1_black_constant_vol.html">QuantLibAddin::BlackConstantVol</a>(</div>
<div class="line">        settlementDate.serialNumber(),  <span class="comment">// settlement date as long</span></div>
<div class="line">        volatility,                     <span class="comment">// volatility</span></div>
<div class="line">        <span class="stringliteral">&quot;Actual360&quot;</span>));                  <span class="comment">// daycount convention</span></div>
<div class="line">    storeObject(<span class="stringliteral">&quot;my_blackconstantvol&quot;</span>, blackConstantVol);</div>
<div class="line"> </div>
<div class="line">    obj_ptr blackScholesProcess(<span class="keyword">new</span> QuantLibAddin::BlackScholesProcess(</div>
<div class="line">        <span class="stringliteral">&quot;my_blackconstantvol&quot;</span>,          <span class="comment">// black constant vol handle</span></div>
<div class="line">        underlying,                     <span class="comment">// underlying</span></div>
<div class="line">        <span class="stringliteral">&quot;Actual360&quot;</span>,                    <span class="comment">// daycount convention</span></div>
<div class="line">        settlementDate.serialNumber(),  <span class="comment">// settlement date as long</span></div>
<div class="line">        riskFreeRate,                   <span class="comment">// risk free rate</span></div>
<div class="line">        dividendYield));                <span class="comment">// dividend yield</span></div>
<div class="line">    storeObject(<span class="stringliteral">&quot;my_blackscholes&quot;</span>, blackScholesProcess);</div>
<div class="line"> </div>
<div class="line">    obj_ptr vanillaOption(<span class="keyword">new</span> <a class="code" href="class_quant_lib_addin_1_1_vanilla_option.html">QuantLibAddin::VanillaOption</a>(</div>
<div class="line">        <span class="stringliteral">&quot;my_blackscholes&quot;</span>,              <span class="comment">// stochastic process handle</span></div>
<div class="line">        <span class="stringliteral">&quot;Put&quot;</span>,                          <span class="comment">// option type</span></div>
<div class="line">        <span class="stringliteral">&quot;Vanilla&quot;</span>,                      <span class="comment">// payoff type</span></div>
<div class="line">        strike,                         <span class="comment">// strike price</span></div>
<div class="line">        <span class="stringliteral">&quot;American&quot;</span>,                     <span class="comment">// exercise type</span></div>
<div class="line">        exerciseDate.serialNumber(),    <span class="comment">// exercise date</span></div>
<div class="line">        settlementDate.serialNumber(),  <span class="comment">// settlement date</span></div>
<div class="line">        <span class="stringliteral">&quot;JR&quot;</span>,                           <span class="comment">// engine type (jarrow rudd)</span></div>
<div class="line">        timeSteps));                    <span class="comment">// time steps</span></div>
<div class="line">    storeObject(<span class="stringliteral">&quot;my_option&quot;</span>, vanillaOption);</div>
<div class="line"> </div>
<div class="line">    logMessage(<span class="stringliteral">&quot;High-level interrogation of VanillaOption&quot;</span>);</div>
<div class="line">    logObject(<span class="stringliteral">&quot;my_option&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    boost::shared_ptr&lt;QuantLibAddin::VanillaOption&gt; vanillaOptionQLA =</div>
<div class="line">        OH_GET_OBJECT(<a class="code" href="class_quant_lib_addin_1_1_vanilla_option.html">QuantLibAddin::VanillaOption</a>, <span class="stringliteral">&quot;my_option&quot;</span>);</div>
<div class="line">    <span class="keywordflow">if</span> (!vanillaOptionQLA)</div>
<div class="line">        QL_FAIL(<span class="stringliteral">&quot;Error retrieving object my_option&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    vanillaOptionQLA-&gt;setEngine(</div>
<div class="line">        <span class="stringliteral">&quot;AEQPB&quot;</span>,    <span class="comment">// AdditiveEQPBinomialTree</span></div>
<div class="line">        timeSteps);</div>
<div class="line"> </div>
<div class="line">    logMessage(<span class="stringliteral">&quot;High-level interrogation: after setting engine&quot;</span>);</div>
<div class="line">    logObject(<span class="stringliteral">&quot;my_option&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    logMessage(<span class="stringliteral">&quot;Low-level interrogation: NPV of underlying option object&quot;</span>);</div>
<div class="line">    boost::shared_ptr&lt;QuantLib::VanillaOption&gt; vanillaOptionQL = </div>
<div class="line">        OH_GET_REFERENCE(QuantLib::VanillaOption, vanillaOptionQLA);</div>
<div class="line">    ostringstream s;</div>
<div class="line">    s &lt;&lt; <span class="stringliteral">&quot;underlying option NPV() = &quot;</span> &lt;&lt; vanillaOptionQL-&gt;NPV();</div>
<div class="line">    logMessage(s.str());</div>
<div class="line"> </div>
<div class="line">    logMessage(<span class="stringliteral">&quot;end example program&quot;</span>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment --> <p>Output of the above program:</p>
<div class="center"><img src="images/cmdline.png" alt="" class="inline"/></div> <h1><a class="anchor" id="sec_2_3_2"></a>
2.3.2 Excel</h1>
<div class="center"><img src="images/demo_values.jpg" alt="" class="inline"/></div> <p>Same again with cell formulas instead of values:</p>
<div class="center"><img src="images/demo_formulas.jpg" alt="" class="inline"/></div> <p>A description of each section of the spreadsheet:</p>
<ul>
<li>
<b>Construct an object from native datatypes:</b> Cell formula qlBlackScholesProcess is called to construct a Black Scholes object from numeric values. The formula accepts a 'handle stub' argument which is automatically decorated to create a unique <code>Handle</code> for the object in the ObjectHandler repository. </li>
<li>
<b>Construct an object from native datatypes &amp; other objects:</b> The Black Scholes object created above is passed as an input to qlVanillaOption() which creates an option. Note that only a reference to the cell containing the Black Scholes object - C12 - is passed to qlVanillaOption(). The Addin autmatically accesses cell C12, retrieves the <code>Handle</code> of the Black Scholes object ("stoch1~_0000a"), retrieves the Black Scholes object from ObjectHandler, and passes the object as an argument to the Vanilla Option constructor. qlVanillaOption() returns the decorated <code>Handle</code> of the new Vanilla Option object, which is passed to formula qlNPV() to display the NPV of the option. </li>
<li>
<b>interrogate an existing object with no prior knowledge of its structure:</b> ohObjectPropertyNames() is called on the <code>Handle</code> returned from qlVanillaOption() to get the Object's Property vector. </li>
<li>
<b>Invoke a method of an existing object:</b> The <code>Handle</code> of the option is passed to qlOptionSetEngine() which changes the option's pricing engine, reprices the option, and returns the changed state. Note that qlOptionSetEngine() acts on the option stored above in cell C25 - the option object is amended <em>in situ</em> in ObjectHandler. </li>
</ul>
<p>The interfaces for other spreadsheet Addins are the same and spreadsheets can be shared verbatim between the various products.</p>
<h1><a class="anchor" id="sec_3"></a>
3. Autogeneration</h1>
<p>The code for the platform-specific addins consists of</p>
<ul>
<li>
<b>structure -</b> This refers to registration with the host application etc. </li>
<li>
<b>business functionality - </b> The platform-specific implementation of each QuantLibAddin function </li>
</ul>
<p>The code for each addin's structure is relatively static, this code is written manually when the Addin is created. The code for the business functionality is completely dependent upon the interface defined for QuantLibAddin, this code is generated automatically each time the interface is enhanced.</p>
<p>Autogeneration is accomplished with a Python application, containing one module for each target platform. The application is supplemented with XML files describing the metadata for each function in the QuantLibAddin interface, e.g.:</p>
<pre class="fragment">&lt;Constructor name='qlVanillaOption'&gt;
&lt;description&gt;construct and return a handle to
a Vanilla Option object&lt;/description&gt;
&lt;libraryFunction&gt;VanillaOption&lt;/libraryFunction&gt;
&lt;functionCategory&gt;QuantLib&lt;/functionCategory&gt;
&lt;Parameters&gt;
    &lt;Parameter name='handleBlackScholes' libraryClass='BlackScholesProcess'&gt;
        &lt;type&gt;string&lt;/type&gt;
        &lt;tensorRank&gt;scalar&lt;/tensorRank&gt;
        &lt;description&gt;handle of a Black Scholes Process object&lt;/description&gt;
    &lt;/Parameter&gt;
    &lt;Parameter name='optionType'&gt;
        &lt;type&gt;string&lt;/type&gt;
        &lt;tensorRank&gt;scalar&lt;/tensorRank&gt;
        &lt;description&gt;option type&lt;/description&gt;
    &lt;/Parameter&gt;
    ...
&lt;/Parameters&gt;
&lt;/Constructor&gt;
</pre><p>The autogeneration script loads the metadata from the XML files and passes this to each platform-specific module which automatically generates the business functionality for that Addin, which is then recompiled.</p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="aclass_quant_lib_1_1_handle_html"><div class="ttname"><a href="class_quant_lib_1_1_handle.html">QuantLib::Handle</a></div><div class="ttdef"><b>Definition:</b> basketlossmodels.hpp:32</div></div>
<div class="ttc" id="aclass_quant_lib_addin_1_1_black_constant_vol_html"><div class="ttname"><a href="class_quant_lib_addin_1_1_black_constant_vol.html">QuantLibAddin::BlackConstantVol</a></div><div class="ttdef"><b>Definition:</b> volatilities.hpp:43</div></div>
<div class="ttc" id="aclass_quant_lib_addin_1_1_vanilla_option_html"><div class="ttname"><a href="class_quant_lib_addin_1_1_vanilla_option.html">QuantLibAddin::VanillaOption</a></div><div class="ttdef"><b>Definition:</b> vanillaoption.hpp:33</div></div>
<div class="ttc" id="anamespace_quant_lib_addin_html"><div class="ttname"><a href="namespace_quant_lib_addin.html">QuantLibAddin</a></div><div class="ttdef"><b>Definition:</b> abcd.hpp:38</div></div>
<div class="ttc" id="aclass_quant_lib_addin_1_1_vanilla_option_html_a3d7b03456bd54178a66968788f424772"><div class="ttname"><a href="class_quant_lib_addin_1_1_vanilla_option.html#a3d7b03456bd54178a66968788f424772">QuantLibAddin::VanillaOption::VanillaOption</a></div><div class="ttdeci">VanillaOption(const boost::shared_ptr&lt; ObjectHandler::ValueObject &gt; &amp;properties, const boost::shared_ptr&lt; QuantLib::StrikedTypePayoff &gt; &amp;payoff, const boost::shared_ptr&lt; QuantLib::Exercise &gt; &amp;exercise, bool permanent)</div></div>
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
            </div>
            <div class='clearfix'></div>
<div id="footer">SourceForge logo copyright &#169; Open Source Technology Group<br>reposit logo <a href="http://www.reposit.be">copyright &#169; 2015 reposit Ltd Dublin</a><br>all other content <a href="license.html">copyright &#169; 2004-20015 The QuantLib Group</a></div>
        </div>
        <div class='clearfix'></div>
    </div>
    <div class='clearfix'></div>
</body>
</html>
