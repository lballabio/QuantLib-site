<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>QuantLibAddin: Expose QuantLib Template Classes to QuantLibXL</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="tabs.css">
    <link rel="stylesheet" href="ql.css">
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
</head>
<body>
    <div id='wrapper'>
        <div id='header'>
        <div id='floatleft'><a class="imglink" href="index.html"><img src="images/logo_qla.jpg" width="180" height="72" border="0" alt="QuantLibAddin Logo"/></a></div>
        <div id='floatright'><a class="imglink" href="http://quantlib.org"><img src="images/logo_ql.jpg" width="130" height="82" border="0" alt="QuantLib Logo"/></a></div>
        </div>
        <div id='content'>
            <div id='col-left'>
            <div id="version">Version 1.20.0</div>
                <div id='sidebar'>
<ul>
<li class="menuheader"><a href="index.html">Home</a></li>
<li><a href="installation.html">Installation</a></li>
<li><a href="design.html">Design</a></li>
<li><a href="history.html">History</a></li>
<li><a href="license.html">License</a></li>
<li><a href="people.html">People</a></li>
<li><a href="faq.html">FAQ</a></li>
<li class="menuheader"><a href="functional.html">Functional<br>Documentation</a></li>
<li><a href="manual.html">Manual</a></li>
<li><a href="allfunctions.html">Functions</a></li>
<li><a href="categories.html">Categories</a></li>
<li><a href="enums.html">Enumerations</a></li>
<li class="menuheader"><a href="technical.html">Technical<br>Documentation</a></li>
<li><a href="tutorials.html">Tutorials</a></li>
<li><a href="annotated.html">Classes</a></li>
<li><a href="hierarchy.html">Hierarchy</a></li>
<li><a href="files.html">Files</a></li>
<li><a href="examples.html">Examples</a></li>
</ul>
                </div>
<div class="logo">
<div class="vspace"></div>
<a href="http://www.reposit.be" id="reposit_logo"></a>
<div class="vspace"></div>
<a class="imglink" href="http://sourceforge.net"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=12470&amp;type=1" width="88" height="31" border="0" alt="SourceForge.net Logo"/></a>
<div class="vspace"></div>
</div>
            </div>
            <div id='col-right'>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Expose QuantLib Template Classes to QuantLibXL </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div align="center"><small>&copy; 2011 Andrew Downes</small></div> <div align="center"><small><a href="tutorials.html">back to tutorials index</a></small></div><p>This document demonstrates how to expose a template QuantLib class to excel. As a prerequisite it is assumed that you have already compiled QuantLibXL from source code using the Full build documented in the tutorial <a class="el" href="build_qlxl.html">Build QuantLibXL From Source Code</a>.</p>
<p>Here we expose the QuantLib class PiecewiseZeroInflationCurve. The method used is based on the PiecewiseYieldCurve class which has already been exposed to Excel. This document outlines the necessary steps and gives most of the required code base, for a more detailed explanation see the corresponding files for the PiecewiseYieldCurve. for a tutorial on exposing regular QuantLib classes to QuantLibXL, see also <a class="el" href="extend_tutorial.html">Expose QuantLib Classes to QuantLibXL</a>.</p>
<p>The PiecewiseZeroInflationCurve class can have up to three template arguments. However, for this tutorial we only consider the first template argument, we use the default template type for the second and third arguments.</p>
<p>Some additional classes such as the InflationRateHelper class and ZeroInflationTermStructure class are required to construct a PiecewiseZeroInflationCurve, as such a brief outline of the files and class names used to expose these to Excel is given. Steps 3-6 are the main steps relating to wrapping a template class.</p>
<p><a class="el" href="extend_template_tutorial.html#extend3_expose">1 Expose the InflationRateHelper class</a> <br  />
<a class="el" href="extend_template_tutorial.html#extend3_expose2">2 Expose the ZeroInflationTermStructure Class</a> <br  />
<a class="el" href="extend_template_tutorial.html#extend3_wrap">3 Wrap the QuantLib::PiecewiseZeroInflationCurve Class in a QuantLibAddin Class</a> <br  />
<a class="el" href="extend_template_tutorial.html#extend3_define">4 Define the ObjectHandler::Create Function</a> <br  />
<a class="el" href="extend_template_tutorial.html#extend3_define2">5 Define New Types and Function Category</a> <br  />
<a class="el" href="extend_template_tutorial.html#extend3_define3">6 Define the Constructors for the Enumerated Classes</a> <br  />
<a class="el" href="extend_template_tutorial.html#extend3_auto">7 Auto-generate gensrc Files</a> <br  />
<a class="el" href="extend_template_tutorial.html#extend3_add">8 Add ZeroInflationTermStructure Interface</a> <br  />
 </p>
<h1><a class="anchor" id="extend3_expose"></a>
1 Expose the InflationRateHelper class</h1>
<p>This step is included for completeness, not because it has any relevance to template classes. If we wish to use our PiecewiseZeroInflationCurve in Excel we will need to be able to create InflationRateHelper objects. A tutorial for exposing classes such as this one can be found at <a class="el" href="extend_tutorial.html">Expose QuantLib Classes to QuantLibXL</a> and we will not repeat everything written there in this tutorial. We do provide an outline of the files and code to ensure later code is consistent.</p>
<p>The code for these classes is written in the following two new files:</p>
<pre class="fragment">QuantLibAddin\qlo\inflationratehelper.hpp
QuantLibAddin\qlo\inflationratehelper.cpp
</pre><p>An outline of the code in the header file is given below:</p>
<pre class="fragment">#include &lt;oh/libraryobject.hpp&gt;
#include &lt;ql/termstructures/inflation/piecewisezeroinflationcurve.hpp&gt;
namespace QuantLib {
class ZeroInflationTermStructure;
template&lt;class TS&gt;
class BootstrapHelper;
typedef BootstrapHelper&lt;ZeroInflationTermStructure&gt;
ZeroInflationRateHelper;
}
namespace QuantLibAddin {
class ZeroInflationRateHelper : public
ObjectHandler::LibraryObject&lt;QuantLib::ZeroInflationRateHelper&gt; {
protected:
OH_LIB_CTOR(ZeroInflationRateHelper,
QuantLib::ZeroInflationRateHelper);
};
class ZciisInflationHelper : public ZeroInflationRateHelper {
...
};
}
</pre><p>The code in the .cpp file contains the straightforward implementation of the ZciisInflationHelper constructor. Add these files to the QuantLibObjects project, in the TermStructures folder. The gensrc code is written in the new file:</p>
<pre class="fragment">QuantLibAddin\gensrc\metadata\functions\inflationratehelper.xml
</pre><p>We also use the category name <code>inflationratehelper</code>.</p>
<h1><a class="anchor" id="extend3_expose2"></a>
2 Expose the ZeroInflationTermStructure Class</h1>
<p>To expose the PiecewiseZeroInflationCurve we first create a ZeroInflationTermStructure class in QuantLibAddin. This is only used as a base class for our PiecewiseZeroInflationCurve class and is never instantiated directly from Excel, so while we provide the following wrapper for the class we do not need gensrc code for its constructor. Create the following file:</p>
<pre class="fragment">QuantLibAddin\qlo\inflationtermstructure.hpp
</pre><p>The code for this file is given below:</p>
<pre class="fragment">#ifndef qla_zeroinflationtermstructure_hpp
#define qla_zeroinflationtermstructure_hpp
#include &lt;qlo/termstructures.hpp&gt;
#include &lt;ql/termstructures/inflation/piecewisezeroinflationcurve.hpp&gt;
namespace QuantLib {
template&lt;class TS&gt;
class BootstrapHelper;
typedef BootstrapHelper&lt;ZeroInflationTermStructure&gt;
ZeroInflationRateHelper;
}
namespace QuantLibAddin {
OH_OBJ_CLASS(ZeroInflationTermStructure, TermStructure);
} // namespace
#endif
</pre><p>Add this file to the QuantLibObjects project, in the TermStructures folder.</p>
<h1><a class="anchor" id="extend3_wrap"></a>
3 Wrap the QuantLib::PiecewiseZeroInflationCurve Class in a QuantLibAddin Class</h1>
<p>Create the following two new files:</p>
<pre class="fragment">QuantLibAddin\qlo\piecewisezeroinflationcurve.hpp
QuantLibAddin\qlo\piecewisezeroinflationcurve.cpp
</pre><p>The code for the .hpp file is given below:</p>
<pre class="fragment">#ifndef qla_piecewisezeroinflationcurve_hpp
#define qla_piecewisezeroinflationcurve_hpp
#include &lt;qlo/inflationtermstructure.hpp&gt;
namespace QuantLibAddin {
struct ZeroInflationToken {
enum Interpolator { Linear,
CubicNaturalSpline };
};
class PiecewiseZeroInflationCurve : public
ZeroInflationTermStructure {
public:
PiecewiseZeroInflationCurve(
const boost::shared_ptr&lt;ObjectHandler::ValueObject&gt;&amp;
properties,
const QuantLib::Date&amp; referenceDate,
const QuantLib::Calendar&amp; calendar,
const QuantLib::DayCounter&amp; dayCounter,
const QuantLib::Period&amp; lag,
QuantLib::Frequency frequency,
QuantLib::Rate baseZeroRate,
const QuantLib::Handle&lt;QuantLib::YieldTermStructure&gt;&amp;
nominalTS,
const
std::vector&lt;boost::shared_ptr&lt;QuantLib::ZeroInflationRateHelper&gt; &gt;&amp;
instruments,
QuantLib::Real accuracy,
const std::string&amp; interpolatorID,
bool permanent);
const std::vector&lt;QuantLib::Time&gt;&amp;
times(ZeroInflationToken::Interpolator interpolator) const;
};
}
#endif
</pre><p>The above is largely standard for wrapping a QuantLib class. There are three things to note. Firstly, we have an additional struct ZeroInflationToken which is a placeholder for QuantLib types of the same name. Secondly, the second last argument for the constructor is a string. This string will indicate which interpolator (normally the first template argument) is to be used in the PiecewiseZeroInflationCurve, instead of entering this as a template argument. Finally, we are going to need to write a wrapper for functions we wish to use and we give an example prototype here (the function times(...)). All of these are necessary since we are unable to expose a template class directly to Excel. Clearly more interpolation types and functions are available for the PiecewiseZeroInflationCurve, but to keep this as brief as possible we will only demonstrate these examples. The code for the .cpp file is given below:</p>
<pre class="fragment">#ifdef HAVE_CONFIG_H
#include &lt;qlo/config.hpp&gt;
#endif
#include &lt;qlo/piecewisezeroinflationcurve.hpp&gt;
#include
&lt;qlo/enumerations/factories/inflationtermstructuresfactory.hpp&gt;
#include &lt;ql/math/interpolations/all.hpp&gt;
namespace QuantLibAddin {
PiecewiseZeroInflationCurve::PiecewiseZeroInflationCurve(
const boost::shared_ptr&lt;ObjectHandler::ValueObject&gt;&amp;
properties,
const QuantLib::Date&amp; referenceDate,
const QuantLib::Calendar&amp; calendar,
const QuantLib::DayCounter&amp; dayCounter,
const QuantLib::Period&amp; lag,
QuantLib::Frequency frequency,
QuantLib::Rate baseZeroRate,
const QuantLib::Handle&lt;QuantLib::YieldTermStructure&gt;&amp;
nominalTS,
const
std::vector&lt;boost::shared_ptr&lt;QuantLib::ZeroInflationRateHelper&gt; &gt;&amp;
instruments,
QuantLib::Real accuracy,
const std::string&amp; interpolatorID,
bool permanent) : ZeroInflationTermStructure(properties,
permanent)
{
libraryObject_ = ObjectHandler::Create&lt;boost::shared_ptr&lt;
QuantLib::ZeroInflationTermStructure&gt; &gt;()(interpolatorID,
referenceDate,
calendar,
dayCounter,
lag,
frequency,
baseZeroRate,
nominalTS,
instruments,
accuracy);
}
namespace InflationCall {
class InflationCallerBase {
public:
virtual const std::vector&lt;QuantLib::Time&gt;&amp; times(const
QuantLib::Extrapolator *extrapolator) const = 0;
virtual ~InflationCallerBase() {}
};
template &lt;class Interpolator&gt;
class InflationCaller : public InflationCallerBase {
typedef QuantLib::PiecewiseZeroInflationCurve&lt;Interpolator&gt;
InflationCurveClass;
const InflationCurveClass *get(const QuantLib::Extrapolator
*extrapolator) const {
const InflationCurveClass *ret = dynamic_cast&lt;const
InflationCurveClass*&gt;(extrapolator);
OH_REQUIRE(ret, "Unable to convert from type " &lt;&lt;
typeid(extrapolator).name()
&lt;&lt; " to type " &lt;&lt; typeid(InflationCurveClass).name());
return ret;
}
virtual const std::vector&lt;QuantLib::Time&gt;&amp; times(const
QuantLib::Extrapolator *extrapolator) const {
return get(extrapolator)-&gt;times();
}
};
typedef ZeroInflationToken::Interpolator Token;
std::ostream &amp;operator&lt;&lt;(std::ostream &amp;out, Token token) {
out &lt;&lt; "PiecewiseZeroInflationCurve&lt;";
switch (token) {
case ZeroInflationToken::Linear:
out &lt;&lt; "Linear&gt;";
break;
case ZeroInflationToken::CubicNaturalSpline:
out &lt;&lt; "CubicNaturalSpline&gt;";
break;
default:
OH_FAIL("Unknown value for enumeration
QuantLibAddin::ZeroInflationToken::Interpolator");
}
return out;
}
class InflationCallerFactory {
typedef std::map&lt;Token, InflationCallerBase*&gt;
InflationCallerMap;
InflationCallerMap inflationCallerMap_;
template &lt;class Interpolator&gt;
void init(Token token) {
inflationCallerMap_[token] = new
InflationCaller&lt;Interpolator&gt;;
}
public:
InflationCallerFactory() {
init&lt;QuantLib::Linear&gt;(
Token(ZeroInflationToken::Linear));
init&lt;QuantLib::Cubic&gt;(
Token(ZeroInflationToken::CubicNaturalSpline));
}
~InflationCallerFactory() {
for (InflationCallerMap::const_iterator i =
inflationCallerMap_.begin(); i != inflationCallerMap_.end(); i++)
delete i-&gt;second;
}
const InflationCallerBase *getInflationCaller(Token token)
const {
InflationCallerMap::const_iterator i =
inflationCallerMap_.find(token);
OH_REQUIRE(i!=inflationCallerMap_.end(), "Unable to
retrieve caller for type " &lt;&lt; token);
return i-&gt;second;
}
};
const InflationCallerFactory &amp;inflationCallerFactory() {
static InflationCallerFactory inflationCallerFactory_;
return inflationCallerFactory_;
}
} // namespace InflationCall
#define INFLATIONCALL(FUNC) \
InflationCall::inflationCallerFactory().getInflationCaller(InflationCal
l::Token(interpolator))-&gt;FUNC(libraryObject_.get())
const std::vector&lt;QuantLib::Time&gt;&amp;
PiecewiseZeroInflationCurve::times(
ZeroInflationToken::Interpolator interpolator) const {
return INFLATIONCALL(times);
}
}
</pre><p>Initially we have the constructor definition, as for other "standard" classes we expose to Excel. In this example the constructor calls the ObjectHandler::Create function which we define in the next step. Inside the namespace InflationCall we provide the logic to wrap the template class. This consists of a non-template base class (InflationCallerBase) and a template subclass (InflationCaller). We provide a stream operator for logging and error handling. Finally we have a factory which stores a map of pointers and wrappers for member functions. See the documentation in piecewiseyieldcurve.cpp for a more detailed explanation.</p>
<p>Add these files to the QuantLibObjects project, in the TermStructures folder.</p>
<h1><a class="anchor" id="extend3_define"></a>
4 Define the ObjectHandler::Create Function</h1>
<p>Create the new file:</p>
<pre class="fragment">QuantLibAddin\qlo\enumerations\factories\inflationtermstructuresfactory.hpp
</pre><p>This file defines the Create function called by the constructor in the previous step. The code for this file is:</p>
<pre class="fragment">#ifndef qla_termstructuresfactory_hpp
#define qla_termstructuresfactory_hpp
#include &lt;oh/enumerations/typefactory.hpp&gt;
#include &lt;ql/types.hpp&gt;
#include &lt;ql/termstructures/inflationtermstructure.hpp&gt;
namespace QuantLib {
template&lt;class TS&gt;
class BootstrapHelper;
typedef BootstrapHelper&lt;ZeroInflationTermStructure&gt;
ZeroInflationRateHelper;
}
namespace ObjectHandler {
typedef
boost::shared_ptr&lt;QuantLib::ZeroInflationTermStructure&gt;(*ZeroInflationT
ermStructureConstructor)(
const QuantLib::Date&amp; referenceDate,
const QuantLib::Calendar&amp; calendar,
const QuantLib::DayCounter&amp; dayCounter,
const QuantLib::Period&amp; lag,
QuantLib::Frequency frequency,
QuantLib::Rate baseZeroRate,
const QuantLib::Handle&lt;QuantLib::YieldTermStructure&gt;&amp;
nominalTS,
const
std::vector&lt;boost::shared_ptr&lt;QuantLib::ZeroInflationRateHelper&gt; &gt;&amp; rh,
QuantLib::Real accuracy);
template&lt;&gt;
class
Create&lt;boost::shared_ptr&lt;QuantLib::ZeroInflationTermStructure&gt; &gt; :
private RegistryManager&lt;QuantLib::ZeroInflationTermStructure,
EnumClassRegistry&gt; {
public:
boost::shared_ptr&lt;QuantLib::ZeroInflationTermStructure&gt;
operator() (
const std::string&amp; interpolatorID,
const QuantLib::Date&amp; referenceDate,
const QuantLib::Calendar&amp; calendar,
const QuantLib::DayCounter&amp; dayCounter,
const QuantLib::Period&amp; lag,
QuantLib::Frequency frequency,
QuantLib::Rate baseZeroRate,
const
QuantLib::Handle&lt;QuantLib::YieldTermStructure&gt;&amp; nominalTS,
const
std::vector&lt;boost::shared_ptr&lt;QuantLib::ZeroInflationRateHelper&gt; &gt;&amp; rh,
QuantLib::Real accuracy) {
ZeroInflationTermStructureConstructor
zeroInflationTermStructureConstructor =
reinterpret_cast&lt;ZeroInflationTermStructureConstructor&gt;(getType(interpo
latorID));
return zeroInflationTermStructureConstructor(referenceDate,
calendar,
dayCounter, lag,
frequency,
baseZeroRate,
nominalTS, rh,
accuracy);
}
using RegistryManager&lt;QuantLib::ZeroInflationTermStructure,
EnumClassRegistry&gt;::registerType;
};
}
#endif
</pre><p>Add this file to the QuantLibObjects project, in the enumerations/factories folder.</p>
<h1><a class="anchor" id="extend3_define2"></a>
5 Define New Types and Function Category</h1>
<p>Open the file: </p><pre class="fragment">QuantLibAddin\gensrc\metadata\types\types.xml
</pre><p>Add the following code inside the &lt;DataTypes&gt; ... &lt;/DataTypes&gt; tags.</p>
<pre class="fragment">&lt;DataType defaultSuperType='enumeration'&gt;QuantLibAddin::ZeroInflationToken::Interpolator&lt;/DataType&gt;
&lt;DataType defaultSuperType='libraryClass'&gt;QuantLib::ZeroInflationRateHelper&lt;/DataType&gt;
&lt;DataType defaultSuperType='objectClass'&gt;QuantLibAddin::ZeroInflationRateHelper&lt;/DataType&gt;
&lt;DataType defaultSuperType='objectClass'&gt;QuantLibAddin::PiecewiseZeroInflationCurve&lt;/DataType&gt;
&lt;DataType defaultSuperType='libraryTermStructure'&gt;QuantLib::ZeroInflationTermStructure&lt;/DataType&gt;
</pre><p>Open the file:</p>
<pre class="fragment">QuantLibAddin\gensrc\config\categories.xml
</pre><p>Add the category piecewisezeroinflaitoncurve:</p>
<pre class="fragment">&lt;root&gt;
&lt;addinCategoryNames&gt;
&lt;categoryName&gt;abcd&lt;/categoryName&gt;
&lt;categoryName&gt;accountingengines&lt;/categoryName&gt;
...
&lt;categoryName&gt;piecewiseyieldcurve&lt;/categoryName&gt;
&lt;categoryName&gt;piecewisezeroinflaitoncurve&lt;/categoryName&gt;
&lt;categoryName&gt;prices&lt;/categoryName&gt;
...
&lt;categoryName&gt;volatility&lt;/categoryName&gt;
&lt;categoryName&gt;quotes&lt;/categoryName&gt;
&lt;/addinCategoryNames&gt;
&lt;/root&gt;
</pre><p>Create the file:</p>
<pre class="fragment">QuantLibAddin\gensrc\metadata\functions\piecewisezeroinflaitoncurve.xml
</pre><p>The code for this file is given below:</p>
<pre class="fragment">&lt;Category name='piecewisezeroinflationcurve'&gt;
&lt;description&gt;functions to construct and use
PiecewiseZeroInflationCurve objects.&lt;/description&gt;
&lt;displayName&gt;Piecewise Zero Inflation Curves&lt;/displayName&gt;
&lt;xlFunctionWizardCategory&gt;QuantLib -
Financial&lt;/xlFunctionWizardCategory&gt;
&lt;serializationIncludes&gt;
&lt;include&gt;qlo/enumerations/factories/inflationtermstructuresfactory.hpp&lt;
/include&gt;
&lt;include&gt;qlo/inflationratehelper.hpp&lt;/include&gt;
&lt;include&gt;qlo/piecewisezeroinflationcurve.hpp&lt;/include&gt;
&lt;include&gt;qlo/yieldtermstructures.hpp&lt;/include&gt;
&lt;include&gt;ql/termstructures/inflation/piecewisezeroinflationcurve.hpp&lt;/i
nclude&gt;
&lt;/serializationIncludes&gt;
&lt;addinIncludes&gt;
&lt;include&gt;qlo/yieldtermstructures.hpp&lt;/include&gt;
&lt;include&gt;qlo/inflationratehelper.hpp&lt;/include&gt;
&lt;include&gt;qlo/piecewisezeroinflationcurve.hpp&lt;/include&gt;
&lt;/addinIncludes&gt;
&lt;copyright&gt;
&lt;/copyright&gt;
&lt;Functions&gt;
&lt;!-- PiecewiseZeroInflationCurve constructor --&gt;
&lt;Constructor name='qlPiecewiseZeroInflationCurve'&gt;
&lt;libraryFunction&gt;PiecewiseZeroInflationCurve&lt;/libraryFunction&gt;
&lt;SupportedPlatforms&gt;
&lt;!--SupportedPlatform name='Excel'
calcInWizard='false'/--&gt;
&lt;SupportedPlatform name='Excel'/&gt;
&lt;SupportedPlatform name='Cpp'/&gt;
&lt;/SupportedPlatforms&gt;
&lt;ParameterList&gt;
&lt;Parameters&gt;
&lt;Parameter name='ReferenceDate'&gt;
&lt;type&gt;QuantLib::Date&lt;/type&gt;
&lt;tensorRank&gt;scalar&lt;/tensorRank&gt;
&lt;description&gt;pricing reference
date.&lt;/description&gt;
&lt;/Parameter&gt;
&lt;Parameter name='Calendar'&gt;
&lt;type&gt;QuantLib::Calendar&lt;/type&gt;
&lt;tensorRank&gt;scalar&lt;/tensorRank&gt;
&lt;description&gt;holiday calendar (e.g. TARGET) to
advance from global EvaluationDate.&lt;/description&gt;
&lt;/Parameter&gt;
&lt;Parameter name='DayCounter' default='"Actual/365
(Fixed)"'&gt;
&lt;type&gt;QuantLib::DayCounter&lt;/type&gt;
&lt;tensorRank&gt;scalar&lt;/tensorRank&gt;
&lt;description&gt;DayCounter ID.&lt;/description&gt;
&lt;/Parameter&gt;
&lt;Parameter name='Lag'&gt;
&lt;type&gt;QuantLib::Period&lt;/type&gt;
&lt;tensorRank&gt;scalar&lt;/tensorRank&gt;
&lt;description&gt;lag period.&lt;/description&gt;
&lt;/Parameter&gt;
&lt;Parameter name='Frequency'&gt;
&lt;type&gt;QuantLib::Frequency&lt;/type&gt;
&lt;tensorRank&gt;scalar&lt;/tensorRank&gt;
&lt;description&gt;frequency.&lt;/description&gt;
&lt;/Parameter&gt;
&lt;Parameter name='BaseZeroRate'&gt;
&lt;type&gt;QuantLib::Rate&lt;/type&gt;
&lt;tensorRank&gt;scalar&lt;/tensorRank&gt;
&lt;description&gt;base zero rate.&lt;/description&gt;
&lt;/Parameter&gt;
&lt;Parameter name='YieldCurve'&gt;
&lt;type&gt;QuantLib::YieldTermStructure&lt;/type&gt;
&lt;superType&gt;libToHandle&lt;/superType&gt;
&lt;tensorRank&gt;scalar&lt;/tensorRank&gt;
&lt;description&gt;yield term structure.&lt;/description&gt;
&lt;/Parameter&gt;
&lt;Parameter name='InflationRateHelpers'&gt;
&lt;type&gt;QuantLib::ZeroInflationRateHelper&lt;/type&gt;
&lt;tensorRank&gt;vector&lt;/tensorRank&gt;
&lt;description&gt;vector of ratehelpers.&lt;/
description&gt;
&lt;/Parameter&gt;
&lt;Parameter name='Accuracy' default='1.0e-12'&gt;
&lt;type&gt;QuantLib::Real&lt;/type&gt;
&lt;tensorRank&gt;scalar&lt;/tensorRank&gt;
&lt;description&gt;Bootstrapping
accuracy.&lt;/description&gt;
&lt;/Parameter&gt;
&lt;Parameter name='InterpolatorID'
default='"LogLinear"'&gt;
&lt;type&gt;string&lt;/type&gt;
&lt;tensorRank&gt;scalar&lt;/tensorRank&gt;
&lt;description&gt;BackwardFlat, ForwardFlat, Linear,
LogLinear, CubicSpline, or LogCubic.&lt;/description&gt;
&lt;/Parameter&gt;
&lt;/Parameters&gt;
&lt;/ParameterList&gt;
&lt;/Constructor&gt;
&lt;!-- PiecewiseYieldCurve interface --&gt;
&lt;Member name='qlPiecewiseZeroInflationCurveTimes'
type='QuantLibAddin::PiecewiseZeroInflationCurve'
superType='objectClass'&gt;
&lt;description&gt;Retrieve list of Times for the given
PiecewiseZeroInflationCurve&amp;lt;Interpolator&amp;gt;.&lt;/description&gt;
&lt;libraryFunction&gt;times&lt;/libraryFunction&gt;
&lt;SupportedPlatforms&gt;
&lt;SupportedPlatform name='Excel'/&gt;
&lt;/SupportedPlatforms&gt;
&lt;ParameterList&gt;
&lt;Parameters&gt;
&lt;Parameter name='Interpolator'&gt;
&lt;type&gt;QuantLibAddin::ZeroInflationToken::Interpolator&lt;/type&gt;
&lt;tensorRank&gt;scalar&lt;/tensorRank&gt;
&lt;description&gt;interpolator.&lt;/description&gt;
&lt;/Parameter&gt;
&lt;/Parameters&gt;
&lt;/ParameterList&gt;
&lt;ReturnValue&gt;
&lt;type&gt;QuantLib::Time&lt;/type&gt;
&lt;tensorRank&gt;vector&lt;/tensorRank&gt;
&lt;/ReturnValue&gt;
&lt;/Member&gt;
&lt;/Functions&gt;
&lt;/Category&gt;
</pre><p>Add the file to the qlgensrc project, in the functions folder.</p>
<h1><a class="anchor" id="extend3_define3"></a>
6 Define the Constructors for the Enumerated Classes</h1>
<p>Open the file:</p>
<pre class="fragment">QuantLibAddin\qlo\enumerations\constructors\enumeratedclasses.hpp
</pre><p>Add the line:</p>
<pre class="fragment">#include &lt;qlo/enumerations/factories/inflationtermstructuresfactory.hpp&gt;
</pre><p>Inside the QuantLibAddin namespace, add the code:</p>
<pre class="fragment">/* *** InflationTermStructures *** */
/* *** PiecewiseZeroInflationCurve *** */
boost::shared_ptr&lt;QuantLib::ZeroInflationTermStructure&gt;
LINEAR_PiecewiseZeroInflationCurve(
const QuantLib::Date&amp; referenceDate,
const QuantLib::Calendar&amp; calendar,
const QuantLib::DayCounter&amp; dayCounter,
const QuantLib::Period&amp; lag,
QuantLib::Frequency frequency,
QuantLib::Rate baseZeroRate,
const QuantLib::Handle&lt;QuantLib::YieldTermStructure&gt;&amp;
nominalTS,
const
std::vector&lt;boost::shared_ptr&lt;QuantLib::ZeroInflationRateHelper&gt; &gt;&amp;
instruments,
QuantLib::Real accuracy);
boost::shared_ptr&lt;QuantLib::ZeroInflationTermStructure&gt;
CUBICNATURALSPLINE_PiecewiseZeroInflationCurve(
const QuantLib::Date&amp; referenceDate,
const QuantLib::Calendar&amp; calendar,
const QuantLib::DayCounter&amp; dayCounter,
const QuantLib::Period&amp; lag,
QuantLib::Frequency frequency,
QuantLib::Rate baseZeroRate,
const QuantLib::Handle&lt;QuantLib::YieldTermStructure&gt;&amp;
nominalTS,
const
std::vector&lt;boost::shared_ptr&lt;QuantLib::ZeroInflationRateHelper&gt; &gt;&amp;
instruments,
QuantLib::Real accuracy);
</pre><p>Open the file:</p>
<pre class="fragment">QuantLibAddin\qlo\enumerations\constructors\enumeratedclasses.cpp
</pre><p>Add the line:</p>
<pre class="fragment">#include &lt;ql/termstructures/inflation/piecewisezeroinflationcurve.hpp&gt;
</pre><p>Inside the QuantLibAddin namespace, add the code:</p>
<pre class="fragment">/* *** InflationTermStructures *** */
/* *** PiecewiseZeroInflationCurve *** */
boost::shared_ptr&lt;QuantLib::ZeroInflationTermStructure&gt;
LINEAR_PiecewiseZeroInflationCurve(
const QuantLib::Date&amp; referenceDate,
const QuantLib::Calendar&amp; calendar,
const QuantLib::DayCounter&amp; dayCounter,
const QuantLib::Period&amp; lag,
QuantLib::Frequency frequency,
QuantLib::Rate baseZeroRate,
const QuantLib::Handle&lt;QuantLib::YieldTermStructure&gt;&amp;
nominalTS,
const
std::vector&lt;boost::shared_ptr&lt;QuantLib::ZeroInflationRateHelper&gt; &gt;&amp;
instruments,
QuantLib::Real accuracy) {
return
boost::shared_ptr&lt;QuantLib::ZeroInflationTermStructure&gt;(new
QuantLib::PiecewiseZeroInflationCurve&lt;QuantLib::Linear&gt;(
referenceDate,
calendar,
dayCounter,
lag,
frequency,
baseZeroRate,
nominalTS,
instruments,
accuracy));
}
boost::shared_ptr&lt;QuantLib::ZeroInflationTermStructure&gt;
CUBICNATURALSPLINE_PiecewiseZeroInflationCurve(
const QuantLib::Date&amp; referenceDate,
const QuantLib::Calendar&amp; calendar,
const QuantLib::DayCounter&amp; dayCounter,
const QuantLib::Period&amp; lag,
QuantLib::Frequency frequency,
QuantLib::Rate baseZeroRate,
const QuantLib::Handle&lt;QuantLib::YieldTermStructure&gt;&amp;
nominalTS,
const
std::vector&lt;boost::shared_ptr&lt;QuantLib::ZeroInflationRateHelper&gt; &gt;&amp;
instruments,
QuantLib::Real accuracy) {
return
boost::shared_ptr&lt;QuantLib::ZeroInflationTermStructure&gt;(new
QuantLib::PiecewiseZeroInflationCurve&lt;QuantLib::Cubic&gt;(
referenceDate,
calendar,
dayCounter,
lag,
frequency,
baseZeroRate,
nominalTS,
instruments,
accuracy,
QuantLib::Cubic(QuantLib::CubicInterpolation::Spline, false,
QuantLib::CubicInterpolation::SecondDerivative, 0.0,
QuantLib::CubicInterpolation::SecondDerivative, 0.0)));
}
</pre><p>Finally, open the file:</p>
<pre class="fragment">QuantLibAddin\gensrc\metadata\enumerations\enumeratedclass.xml
</pre><p>Inside the &lt;EnumeratedClassGroups&gt;... &lt;/EnumeratedClassGroups&gt; tags, add the code:</p>
<pre class="fragment">&lt;EnumeratedClassGroup class='QuantLib::ZeroInflationTermStructure'&gt;
&lt;!--
&lt;includeFile&gt;qlo/enumerations/factories/interpolationsfactory.hpp&lt;/incl
udeFile&gt; --&gt;
&lt;EnumeratedClasses&gt;
&lt;EnumeratedClass&gt;
&lt;string&gt;Linear&lt;/string&gt;
&lt;value&gt;LINEAR_PiecewiseZeroInflationCurve&lt;/value&gt;
&lt;libraryClass&gt;QuantLib::LinearInterpolation&lt;/libraryClass&gt;
&lt;/EnumeratedClass&gt;
&lt;EnumeratedClass&gt;
&lt;string&gt;CubicNaturalSpline&lt;/string&gt;
&lt;value&gt;CUBICNATURALSPLINE_PiecewiseZeroInflationCurve&lt;/value&gt;
&lt;libraryClass&gt;QuantLib::CubicNaturalSpline&lt;/libraryClass&gt;
&lt;/EnumeratedClass&gt;
&lt;/EnumeratedClasses&gt;
&lt;/EnumeratedClassGroup&gt;
</pre><h1><a class="anchor" id="extend3_auto"></a>
7 Auto-generate gensrc Files</h1>
<p>As in the stock tutorial, we need to run gensrc to auto generate the new source code. Build project qlgensrc. This auto-generates the following eleven new files (some output omitted):</p>
<pre class="fragment">1&gt;c:\..\QuantLibXL\qlxl/register/register_piecewisezeroinflationcurve.cpp:
created
1&gt;c:\..\QuantLibXL\qlxl/functions/piecewisezeroinflationcurve.cpp:
created
1&gt;c:\..\QuantLibAddin\Addins\Cpp/piecewisezeroinflationcurve.cpp:
created
1&gt;c:\..\QuantLibAddin\Addins\Cpp/piecewisezeroinflationcurve.hpp:
created
1&gt;c:\..\QuantLibAddin\qlo\valueobjects/vo_piecewisezeroinflationcurve.hpp:
created
1&gt;c:\..\QuantLibAddin\qlo\valueobjects/vo_piecewisezeroinflationcurve.cpp:
created
1&gt;c:\..\QuantLibAddin\qlo\serialization/create/create_piecewisezeroinflationcurve.hpp:
created
1&gt;c:\..\QuantLibAddin\qlo\serialization/create/create_piecewisezeroinflationcurve.cpp:
created
1&gt;c:\..\QuantLibAddin\qlo\serialization/register/serialization_piecewisezeroinflationcurv
e.hpp: created
1&gt;c:\..\QuantLibAddin\qlo\serialization/register/serialization_piecewisezeroinflationcurv
e.cpp: created
1&gt;c:\..\QuantLibAddin\Docs\auto.pages/piecewisezeroinflationcurve.docs:
created
</pre><p>We can ignore the .docs file and the two files created in QuantLibAddin/Addins. The remaining files need to be added to the relevant projects as given by the following table:</p>
<table class="doxtable">
<tr>
<td><b>Add file(s) ...</b></td><td><b>To project ...</b></td><td><b>In folder ...</b> </td></tr>
<tr>
<td>QuantLibXL/qlxl/register/register_piecewisezeroinflationcurve.cpp</td><td>QuantLibXLStatic</td><td>register </td></tr>
<tr>
<td>QuantLibXL/qlxl/functions/piecewisezeroinflationcurve.cpp</td><td>QuantLibXLStatic</td><td>functions </td></tr>
<tr>
<td>QuantLibAddin/qlo/valueobjects/vo_piecewisezeroinflationcurve.*pp</td><td>QuantLibObjects</td><td>valueobjects </td></tr>
<tr>
<td>QuantLibAddin/qlo/serialization/create/create_piecewisezeroinflationcurve.*pp</td><td>QuantLibObjects</td><td>serialization/create </td></tr>
<tr>
<td>QuantLibAddin/qlo/serialization/register/serialization_piecewisezeroinflationcurve.*pp</td><td>QuantLibObjects</td><td>serialization/register </td></tr>
</table>
<h1><a class="anchor" id="extend3_add"></a>
8 Add ZeroInflationTermStructure Interface</h1>
<p>Open the file:</p>
<pre class="fragment">QuantLibAddin\gensrc\metadata\functions\termstructures.xml
</pre><p>Add the following code between &lt;Functions&gt; and &lt;/Functions&gt; tags:</p>
<pre class="fragment">&lt;Member name='qlZeroInflationTSZeroRate'
type='QuantLib::ZeroInflationTermStructure'
superType='libraryTermStructure' loopParameter='Dates'&gt;
&lt;description&gt;zero rate for a given ZeroInflationTermStructure
object.&lt;/description&gt;
&lt;libraryFunction&gt;zeroRate&lt;/libraryFunction&gt;
&lt;SupportedPlatforms&gt;
&lt;SupportedPlatform name='Excel'/&gt;
&lt;/SupportedPlatforms&gt;
&lt;ParameterList&gt;
&lt;Parameters&gt;
&lt;Parameter name='Dates' exampleValue ="'37413,39248"&gt;
&lt;type&gt;QuantLib::Date&lt;/type&gt;
&lt;tensorRank&gt;vector&lt;/tensorRank&gt;
&lt;description&gt;vector of dates.&lt;/description&gt;
&lt;/Parameter&gt;
&lt;Parameter name='AllowExtrapolation' const='False'
default='false'&gt;
&lt;type&gt;bool&lt;/type&gt;
&lt;tensorRank&gt;scalar&lt;/tensorRank&gt;
&lt;description&gt;TRUE allows extrapolation.&lt;/description&gt;
&lt;/Parameter&gt;
&lt;/Parameters&gt;
&lt;/ParameterList&gt;
&lt;ReturnValue&gt;
&lt;type&gt;QuantLib::Probability&lt;/type&gt;
&lt;tensorRank&gt;vector&lt;/tensorRank&gt;
&lt;/ReturnValue&gt;
&lt;/Member&gt;
</pre><p>Note that we have used a loop variable, for a brief explanation see <a class="el" href="loops.html">Looping Functions</a>.</p>
<p>In addition, between both the &lt;serializationIncludes&gt; ... &lt;/serializationIncludes&gt; and the &lt;addinIncludes&gt; ... &lt;/addinIncludes&gt; tags add the line:</p>
<pre class="fragment">&lt;include&gt;qlo/inflationtermstructure.hpp&lt;/include&gt;
</pre><div align="center"><small><a href="tutorials.html">back to tutorials index</a></small></div> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
            </div>
            <div class='clearfix'></div>
<div id="footer">SourceForge logo copyright &#169; Open Source Technology Group<br>reposit logo <a href="http://www.reposit.be">copyright &#169; 2015 reposit Ltd Dublin</a><br>all other content <a href="license.html">copyright &#169; 2004-20015 The QuantLib Group</a></div>
        </div>
        <div class='clearfix'></div>
    </div>
    <div class='clearfix'></div>
</body>
</html>
