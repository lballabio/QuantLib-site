<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>QuantLibAddin: Expose QuantLib Classes to QuantLibXL</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="tabs.css">
    <link rel="stylesheet" href="ql.css">
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
</head>
<body>
    <div id='wrapper'>
        <div id='header'>
        <div id='floatleft'><a class="imglink" href="index.html"><img src="images/logo_qla.jpg" width="180" height="72" border="0" alt="QuantLibAddin Logo"/></a></div>
        <div id='floatright'><a class="imglink" href="http://quantlib.org"><img src="images/logo_ql.jpg" width="130" height="82" border="0" alt="QuantLib Logo"/></a></div>
        </div>
        <div id='content'>
            <div id='col-left'>
            <div id="version">Version 1.20.0</div>
                <div id='sidebar'>
<ul>
<li class="menuheader"><a href="index.html">Home</a></li>
<li><a href="installation.html">Installation</a></li>
<li><a href="design.html">Design</a></li>
<li><a href="history.html">History</a></li>
<li><a href="license.html">License</a></li>
<li><a href="people.html">People</a></li>
<li><a href="faq.html">FAQ</a></li>
<li class="menuheader"><a href="functional.html">Functional<br>Documentation</a></li>
<li><a href="manual.html">Manual</a></li>
<li><a href="allfunctions.html">Functions</a></li>
<li><a href="categories.html">Categories</a></li>
<li><a href="enums.html">Enumerations</a></li>
<li class="menuheader"><a href="technical.html">Technical<br>Documentation</a></li>
<li><a href="tutorials.html">Tutorials</a></li>
<li><a href="annotated.html">Classes</a></li>
<li><a href="hierarchy.html">Hierarchy</a></li>
<li><a href="files.html">Files</a></li>
<li><a href="examples.html">Examples</a></li>
</ul>
                </div>
<div class="logo">
<div class="vspace"></div>
<a href="http://www.reposit.be" id="reposit_logo"></a>
<div class="vspace"></div>
<a class="imglink" href="http://sourceforge.net"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=12470&amp;type=1" width="88" height="31" border="0" alt="SourceForge.net Logo"/></a>
<div class="vspace"></div>
</div>
            </div>
            <div id='col-right'>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Expose QuantLib Classes to QuantLibXL </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><div align="center"><small><a href="tutorials.html">back to tutorials index</a></small></div><p>This document explains how to expose additional QuantLib classes to Excel. As a prerequisite it is assumed that you have already compiled QuantLibXL from source code using the Full build documented in the tutorial <a class="el" href="build_qlxl.html">Build QuantLibXL From Source Code</a>.</p>
<p>In this example, the QuantLib class <code>Stock</code> is exposed to Excel. The Visual C++ solution for this tuturial is <code>QuantLibXL\QuantLibXL_full_vc?.sln</code>.</p>
<p><a class="el" href="extend_tutorial.html#extend_wrap">1 Wrap the QuantLib Class in a QuantLibAddin Class</a> <br  />
<a class="el" href="extend_tutorial.html#extend_category">2 Create a New Function Category</a> <br  />
<a class="el" href="extend_tutorial.html#extend_autogenerate">3 Autogenerate New Source Code Files</a> <br  />
<a class="el" href="extend_tutorial.html#extend_build">4 Build QuantLibXL</a> <br  />
<a class="el" href="extend_tutorial.html#extend_test">5 Test the New Functions</a> <br  />
<a class="el" href="extend_tutorial.html#extend_notes">6 Notes</a> <br  />
 </p>
<h1><a class="anchor" id="extend_wrap"></a>
1 Wrap the QuantLib Class in a QuantLibAddin Class</h1>
<p>In order to store a reference to a <code>QuantLib::Stock</code> in the ObjectHandler repository, we implement class <code>QuantLibAddin::Stock</code> which derives from <code>ObjectHandler::Object</code> and holds a pointer to <code>QuantLib::Stock</code>. In fact, rather than inherit directly from <code>ObjectHandler::Object</code>, we derive our <code>QuantLibAddin::Stock</code> class from <code><a class="el" href="class_quant_lib_addin_1_1_instrument.html">QuantLibAddin::Instrument</a></code>. This allows us to invoke the <code>Instrument</code> interface on objects of class <code>Stock</code>.</p>
<p><img src="images/stock.jpg" alt="" class="inline"/></p>
<p>Create the following two new files: </p><pre class="fragment">QuantLibAddin\qlo\stock.hpp
QuantLibAddin\qlo\stock.cpp
</pre><p>Here is the code for the files:</p>
<p>stock.hpp: </p><pre class="fragment">#ifndef qla_stock_hpp
#define qla_stock_hpp

#include &lt;qlo/baseinstruments.hpp&gt;
#include &lt;ql/handle.hpp&gt;

namespace QuantLib {
    class Stock;
    class Quote;
}

namespace QuantLibAddin {

    class Stock : public Instrument {
        public:
            Stock(
                const boost::shared_ptr&lt;ObjectHandler::ValueObject&gt;&amp; properties,
                const QuantLib::Handle&lt;QuantLib::Quote&gt;&amp; quote,
                bool permanent);
    };

}

#endif
</pre><p>stock.cpp: </p><pre class="fragment">#include &lt;qlo/qladdindefines.hpp&gt;
#include &lt;qlo/stock.hpp&gt;
#include &lt;ql/instruments/stock.hpp&gt;
#include &lt;ql/quote.hpp&gt;

namespace QuantLibAddin {

    Stock::Stock(
            const boost::shared_ptr&lt;ObjectHandler::ValueObject&gt;&amp; properties,
            const QuantLib::Handle&lt;QuantLib::Quote&gt;&amp; quote,
            bool permanent) : Instrument(properties, permanent) {
        libraryObject_ = boost::shared_ptr&lt;QuantLib::Stock&gt;(
            new QuantLib::Stock(quote));
    }

}
</pre><p>Add the files to project QuantLibObjects, under folder Instruments.</p>
<h1><a class="anchor" id="extend_category"></a>
2 Create a New Function Category</h1>
<p>QuantLibAddin functions are grouped into Categories. Here we create a new category called Stock.</p>
<p>Edit file QuantLibAddin\gensrc\config\categories.xml and add the new category stock:</p>
<p><code>&lt;root&gt;</code></p>
<p><code>&#160;&#160;&lt;addinCategoryNames&gt;<br  />
 &#160;&#160;&#160;&#160;&lt;categoryName&gt;abcd&lt;/categoryName&gt;<br  />
 &#160;&#160;&#160;&#160;&lt;categoryName&gt;accountingengines&lt;/categoryName&gt;<br  />
 &#160;&#160;&#160;&#160;&lt;categoryName&gt;assetswap&lt;/categoryName&gt;<br  />
 &#160;&#160;&#160;&#160;...<br  />
 &#160;&#160;&#160;&#160;&lt;categoryName&gt;statistics&lt;/categoryName&gt;<br  />
 &#160;&#160;&#160;&#160;<b>&lt;categoryName&gt;stock&lt;/categoryName&gt;</b><br  />
 &#160;&#160;&#160;&#160;&lt;categoryName&gt;swap&lt;/categoryName&gt;<br  />
 &#160;&#160;&#160;&#160;...<br  />
 &#160;&#160;&#160;&#160;&lt;categoryName&gt;volatilities&lt;/categoryName&gt;<br  />
 &#160;&#160;&#160;&#160;&lt;categoryName&gt;volatility&lt;/categoryName&gt;<br  />
 &#160;&#160;&#160;&#160;&lt;categoryName&gt;quotes&lt;/categoryName&gt;<br  />
 &#160;&#160;&lt;/addinCategoryNames&gt;<br  />
</code></p>
<p><code>&lt;/root&gt;</code></p>
<p>Create the following new file: </p><pre class="fragment">QuantLibAddin\gensrc\metadata\Functions\stock.xml
</pre><p>Here are the contents of the file:</p>
<pre class="fragment">&lt;Category name='stock'&gt;
  &lt;description&gt;functions to construct and use Stock objects&lt;/description&gt;
  &lt;displayName&gt;Stock&lt;/displayName&gt;
  &lt;xlFunctionWizardCategory&gt;QuantLib - Financial&lt;/xlFunctionWizardCategory&gt;
  &lt;includes&gt;
    &lt;include&gt;qlo/stock.hpp&lt;/include&gt;
  &lt;/includes&gt;
  &lt;copyright&gt;
    Copyright (C) 2008 Eric Ehlers
  &lt;/copyright&gt;

  &lt;Functions&gt;

    &lt;Constructor name='qlStock'&gt;
      &lt;libraryFunction&gt;Stock&lt;/libraryFunction&gt;
      &lt;SupportedPlatforms&gt;
        &lt;SupportedPlatform name='Excel'/&gt;
      &lt;/SupportedPlatforms&gt;
      &lt;ParameterList&gt;
        &lt;Parameters&gt;
          &lt;Parameter name='Quote'&gt;
            &lt;type&gt;QuantLib::Quote&lt;/type&gt;
            &lt;superType&gt;libToHandle&lt;/superType&gt;
            &lt;tensorRank&gt;scalar&lt;/tensorRank&gt;
            &lt;description&gt;quote object IDs&lt;/description&gt;
          &lt;/Parameter&gt;
        &lt;/Parameters&gt;
      &lt;/ParameterList&gt;
    &lt;/Constructor&gt;

  &lt;/Functions&gt;

&lt;/Category&gt;
</pre><p>Add the file to project <code>qlgensrc</code>, under folder <code>functions</code>.</p>
<p>Above we have configured a single constructor. There is also support for member and utility functions, refer to the other XML files for examples. The tag <code>superType</code> determines the type of reference which is passed to the underlying QuantLib code, in this case <code>libToHandle</code> reflects the fact that <code>Handle&lt;Quote&gt;</code> is expected. For a summary of supported supertypes refer to the comments in file <code>QuantLibAddin\gensrc\metadata\types\supertypes.xml</code>.</p>
<h1><a class="anchor" id="extend_autogenerate"></a>
3 Autogenerate New Source Code Files</h1>
<p>Now we run gensrc to autogenerate the new source code corresponding to the contents of stock.xml. Build project qlgensrc. In the gensrc output, notice that 9 new files are created (irrelevant output omitted):</p>
<pre class="fragment">1&gt;C:\..\QuantLibXL\qlxl\register\register_stock.cpp:                       created
1&gt;C:\..\QuantLibXL\qlxl\functions\stock.cpp:                               created
1&gt;C:\..\QuantLibAddin\qlo\valueobjects\vo_stock.hpp:                       created
1&gt;C:\..\QuantLibAddin\qlo\valueobjects\vo_stock.cpp:                       created
1&gt;C:\..\QuantLibAddin\qlo\serialization\create\create_stock.hpp:           created
1&gt;C:\..\QuantLibAddin\qlo\serialization\create\create_stock.cpp:           created
1&gt;C:\..\QuantLibAddin\qlo\serialization\register\serialization_stock.hpp:  created
1&gt;C:\..\QuantLibAddin\qlo\serialization\register\serialization_stock.cpp:  created
1&gt;C:\..\QuantLibAddin\Docs\auto.pages\stock.docs:                          created
1&gt;
1&gt;addin           unchanged   updated     created     total
1&gt;=============== =========== =========== =========== ===========
1&gt;Excel                   114           2           2         118
1&gt;Calc                     23           0           0          23
1&gt;Cpp                     111           0           0         111
1&gt;ValueObjects             98           1           2         101
1&gt;Enumerations              3           0           0           3
1&gt;Loop                     11           0           0          11
1&gt;Serialization           188          12           4         204
1&gt;Doxygen                  67           2           1          70
1&gt;=============== =========== =========== =========== ===========
1&gt;total                   615          17           9         641
</pre><p>For purposes of this tutorial we ignore the new file for Doxygen. The other 8 files need to be added to the relevant projects as shown below:</p>
<table class="doxtable">
<tr>
<td><b>Add file(s) ...</b></td><td><b>To project ...</b></td><td><b>In folder ...</b> </td></tr>
<tr>
<td>QuantLibXL/qlxl/register/register_stock.cpp</td><td>QuantLibXLStatic</td><td>register </td></tr>
<tr>
<td>QuantLibXL/qlxl/functions/stock.cpp</td><td>QuantLibXLStatic</td><td>functions </td></tr>
<tr>
<td>QuantLibAddin/qlo/valueobjects/vo_stock.*pp</td><td>QuantLibObjects</td><td>valueobjects </td></tr>
<tr>
<td>QuantLibAddin/qlo/serialization/create/create_stock.*pp</td><td>QuantLibObjects</td><td>serialization/create </td></tr>
<tr>
<td>QuantLibAddin/qlo/serialization/register/serialization_stock.*pp</td><td>QuantLibObjects</td><td>serialization/register </td></tr>
</table>
<h1><a class="anchor" id="extend_build"></a>
4 Build QuantLibXL</h1>
<p>Build solution <code>QuantLibXL_full_vc?.sln</code>, configuration <code>Release (static runtime)</code>. The new source code files in QuantLibAddin and QuantLibXL are compiled and the binaries are linked.</p>
<p>The build process creates the QuantLibAddin XLL file <code>QuantLibXL\xll\QuantLibXL-vc??-mt-s-1_20_0.xll</code>.</p>
<h1><a class="anchor" id="extend_test"></a>
5 Test the New Functions</h1>
<p>Start Excel and load the XLL. Enter the new constructor into cell A1:</p>
<pre class="fragment">=qlStock("my_stock",1.23)
</pre><p>This should return the ID of the newly created object. Try invoking a member function on the object. In cell A2, enter:</p>
<pre class="fragment">=qlInstrumentNPV(A1)
</pre><p>This should return the value 1.23.</p>
<h1><a class="anchor" id="extend_notes"></a>
6 Notes</h1>
<ul>
<li>See also project <code>ExampleXllStatic</code> in solution <code>ObjectHandler\ObjectHandler_vc?.sln</code>. This is a hello world XLL using ObjectHandler to export an object-oriented interface (constructors and member functions) to Excel. All of the source code is hand-written, as opposed to the QuantLibXL code which is autogenerated by gensrc. <code>ExampleXllStatic</code> relies on an example library called <code>ExampleObjects</code> which could be replaced by QuantLib or some third-party library.</li>
</ul>
<ul>
<li>If you're going to rerun gensrc often, and if you're only interested in the Excel addin, then you can speed gensrc up by opening file <pre class="fragment">QuantLibAddin/gensrc/Makefile.vc
</pre> and editing line 28: <pre class="fragment">    #$(GENSRC_DIR)\gensrc.py -a --oh_dir=$(OH_DIR)
    $(GENSRC_DIR)\gensrc.py -xvels --oh_dir=$(OH_DIR)
</pre> This restricts the gensrc output from "all" (including C++ and Calc) to only the modules required for QuantLibXL.</li>
</ul>
<div align="center"><small><a href="tutorials.html">back to tutorials index</a></small></div> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
            </div>
            <div class='clearfix'></div>
<div id="footer">SourceForge logo copyright &#169; Open Source Technology Group<br>reposit logo <a href="http://www.reposit.be">copyright &#169; 2015 reposit Ltd Dublin</a><br>all other content <a href="license.html">copyright &#169; 2004-20015 The QuantLib Group</a></div>
        </div>
        <div class='clearfix'></div>
    </div>
    <div class='clearfix'></div>
</body>
</html>
