<!-- HTML header for doxygen 1.8.7-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<title>ObjectHandler: Design</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="tabs.css">
    <link rel="stylesheet" href="ql.css">
    <link rel="shortcut icon" href="images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="images/favicon.ico" type="image/x-icon">
</head>
<body>
    <div id='wrapper'>
        <div id='header'>
        <div id='floatleft'><a class="imglink" href="index.html"><img src="images/logo_oh.jpg" width="180" height="72" border="0" alt="ObjectHandler Logo"/></a></div>
        <div id='floatright'><a class="imglink" href="http://quantlib.org"><img src="images/logo_ql.jpg" width="130" height="82" border="0" alt="QuantLib Logo"/></a></div>
        </div>
        <div id='content'>
            <div id='col-left'>
            <div id="version">Version 1.20.0</div>
                <div id='sidebar'>
<ul>
<li class="menuheader"><a href="index.html">Home</a></li>
<li><a href="installation.html">Installation</a></li>
<li><a href="design.html">Design</a></li>
<li><a href="history.html">History</a></li>
<li><a href="license.html">License</a></li>
<li><a href="people.html">People</a></li>
<li class="menuheader"><a href="functional.html">Functional<br>Documentation</a></li>
<li><a href="manual.html">Manual</a></li>
<li><a href="allfunctions.html">Functions</a></li>
<li><a href="categories.html">Categories</a></li>
<li class="menuheader"><a href="technical.html">Technical<br>Documentation</a></li>
<li><a href="annotated.html">Classes</a></li>
<li><a href="hierarchy.html">Hierarchy</a></li>
<li><a href="files.html">Files</a></li>
<li><a href="examples.html">Examples</a></li>
</ul>
                </div>
<div class="logo">
<div class="vspace"></div>
<a href="http://www.reposit.be" id="reposit_logo"></a>
<div class="vspace"></div>
<a class="imglink" href="http://sourceforge.net"><img src="http://sflogo.sourceforge.net/sflogo.php?group_id=12470&amp;type=1" width="88" height="31" border="0" alt="SourceForge.net Logo"/></a>
<div class="vspace"></div>
</div>
            </div>
            <div id='col-right'>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Design </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><table border="1" bgcolor="lightsteelblue">
<tr>
<td><b>NB:</b> This document is out of date. The ObjectHandler implementation still reflects the high-level ideas in this document but many of the details have changed. For further information please refer to the ObjectHandler source code or send email to <a href="#" onclick="location.href='mai'+'lto:'+'qua'+'nt'+'lib'+'-u'+'ser'+'s@'+'lis'+'ts'+'.sf'+'.n'+'et'; return false;">quant<span style="display: none;">.nosp@m.</span>lib-<span style="display: none;">.nosp@m.</span>users<span style="display: none;">.nosp@m.</span>@lis<span style="display: none;">.nosp@m.</span>ts.sf<span style="display: none;">.nosp@m.</span>.net</a>.  </td></tr>
</table>
<h1><a class="anchor" id="sec_00"></a>
Abstract</h1>
<dl class="section user"><dt></dt><dd>QuantLib integration into spreadsheets and other end user tools requires a new standalone <b>ObjectHandler</b> component, a repository allowing objects to be stored, shared, updated, interrogated, and destroyed. </dd></dl>
<h1><a class="anchor" id="sec_01"></a>
Contents</h1>
<dl>
<dt><a class="el" href="design.html#sec_1"><ol type="1">
<li>Design</li>
</ol>
</a> </dt>
<dd><dl>
<dt><a class="el" href="design.html#sec_1_1">1.1 ObjectHandler</a> </dt>
<dd><dl>
<dt><a class="el" href="design.html#sec_1_1_1">1.1.1 Object</a> </dt>
<dd></dd>
<dt><a class="el" href="design.html#sec_1_1_2">1.1.2 ObjectHandler</a> </dt>
<dd></dd>
<dt><a class="el" href="design.html#sec_1_1_3">1.1.3 boost::any</a> </dt>
<dd></dd>
<dt><a class="el" href="design.html#sec_1_1_4">1.1.4 Property</a> </dt>
<dd></dd>
<dt><a class="el" href="design.html#sec_1_1_5">1.1.5 Factory</a> </dt>
<dd></dd>
</dl>
</dd>
<dt><a class="el" href="design.html#sec_1_2">1.2 Client</a> </dt>
<dd><dl>
<dt><a class="el" href="design.html#sec_1_2_1">1.2.1 Object</a> </dt>
<dd></dd>
<dt><a class="el" href="design.html#sec_1_2_2">1.2.2 Factory</a> </dt>
<dd></dd>
</dl>
</dd>
</dl>
</dd>
<dt><a class="el" href="design.html#sec_2">2 Implementation</a> </dt>
<dd><dl>
<dt><a class="el" href="design.html#sec_2_1">2.1 ObjectHandler</a> </dt>
<dd><dl>
<dt><a class="el" href="design.html#sec_2_1_1">2.1.1 Object</a> </dt>
<dd></dd>
<dt><a class="el" href="design.html#sec_2_1_2">2.1.2 ObjectHandler</a> </dt>
<dd></dd>
</dl>
</dd>
<dt><a class="el" href="design.html#sec_2_2">2.2 Client</a> </dt>
<dd><dl>
<dt><a class="el" href="design.html#sec_2_2_1">2.2.1 Object</a> </dt>
<dd></dd>
<dt><a class="el" href="design.html#sec_2_2_2">2.2.2 Application</a> </dt>
<dd></dd>
</dl>
</dd>
</dl>
</dd>
<dt><a class="el" href="design.html#sec_3">3 Proposed Enhancements</a> </dt>
<dd></dd>
<dt><a class="el" href="design.html#sec_4">4 Feedback</a> </dt>
<dd></dd>
</dl>
<h1><a class="anchor" id="sec_1"></a>
1. Design</h1>
<div class="center"><img src="images/quep011a.png" alt="" class="inline"/></div> <h1><a class="anchor" id="sec_1_1"></a>
1.1 ObjectHandler</h1>
<dl class="section user"><dt></dt><dd>ObjectHandler maintains a repository of objects, each identified by a unique <code>Handle</code> provided by the client. ObjectHandler facilitates: <ul>
<li>
<b>persistence</b>: Objects can be maintained and modified throughout the life of the client application. </li>
<li>
<b>sharing</b>: Each client application instantiates a single global instance of ObjectHandler. Objects created in one area of the application can be accessed in another - for example, in a spreadsheet, one sheet can refer to objects instantiated on another. </li>
</ul>
</dd></dl>
<h1><a class="anchor" id="sec_1_1_1"></a>
1.1.1 Object</h1>
<dl class="section user"><dt></dt><dd>Abstract base class <code>Object</code> implements the interface required by ObjectHander for managing <code>Object</code>s - constructor, copy constructor, assignment operator, destructor. </dd></dl>
<dl class="section user"><dt></dt><dd>Client objects retained in the ObjectHandler repository are represented by classes derived from <code>Object</code>. Typically the constructor of the derived <code>Object</code> class invokes the constructor of the corresponding client class, and the resulting client object is retained in a member variable of the derived <code>Object</code> class. The derived <code>Object</code> class may also wrap member functions of the client class. </dd></dl>
<dl class="section user"><dt></dt><dd>The <code>Object</code> class supports two interfaces for the client application to interrogate the stored object: <ul>
<li>
<b>high-level</b> access implemented by member functions which allow the client to query the object at run-time with no prior knowledge of its implementation. </li>
<li>
<b>low-level</b> access implemented by a member function which returns a const reference to the underlying client object stored within the derived <code>Object</code>. </li>
</ul>
</dd></dl>
<h1><a class="anchor" id="sec_1_1_2"></a>
1.1.2 ObjectHandler</h1>
<dl class="section user"><dt></dt><dd>A single global instance of class <code>ObjectHandler</code> implements the interface required by the client to store and retrieve objects in the repository. Global scope is achieved by deriving <code>ObjectHandler</code> from <code>Singleton</code>. </dd></dl>
<h1><a class="anchor" id="sec_1_1_3"></a>
1.1.3 boost::any</h1>
<dl class="section user"><dt></dt><dd>ObjectHandler uses Boost class <code>boost::any</code> to represent a scalar, vector, or matrix of native datatypes, <code>Object</code>s, or other <code>boost::any</code>s. Class <code>boost::any</code> serves as a proxy for similar constructs in target client environments (uno::Any in Calc, XLOPER in Excel, etc.) </dd></dl>
<h1><a class="anchor" id="sec_1_1_4"></a>
1.1.4 Property</h1>
<dl class="section user"><dt></dt><dd>Object properties are implemented as a vector of template class <code>Property</code> (Daniel Duffy, <em>Financial Instrument Pricing Using C++</em>) which stores attributes as key/value pairs. Use of the <code>Property</code> vector allows derived <code>Object</code>s to maintain their attributes dynamically, while the client interrogates objects through the standard interface in the base class. </dd></dl>
<h1><a class="anchor" id="sec_1_1_5"></a>
1.1.5 Factory</h1>
<dl class="section user"><dt></dt><dd>A class template implements function <code>makeObject</code> which instantiates an <code>Object</code> in <code>ObjectHandler</code> given a classname and handle. Function <code>makeObject</code> accepts an argument list, implemented as <code>stack &lt; any &gt;</code>, which is passed to the <code>Object's</code> constructor. Where the constructor of one <code>Object</code> requires access to another existing <code>Object</code>, the Handle of the existing <code>Object</code> can be pushed onto the argument stack, allowing the new <code>Object</code> to retrieve the existing one from the <code>ObjectHandler</code> repository. </dd></dl>
<h1><a class="anchor" id="sec_1_2"></a>
1.2 Client</h1>
<dl class="section user"><dt></dt><dd>A Client application using ObjectHandler implements the components described below. </dd></dl>
<h1><a class="anchor" id="sec_1_2_1"></a>
1.2.1 Object</h1>
<dl class="section user"><dt></dt><dd>Classes of Client objects to be stored in ObjectHandler are wrapped in classes derived from <code>Object</code>. The derived <code>Object</code> class overrides the base <code>Object</code> class's member functions as appropriate for the corresponding Client class: <ul>
<li>
<b>constructor</b> constructs the corresponding Client object, which is retained as a member variable of the <code>Object</code>. </li>
<li>
<b>copy constructor, assignment operator, destructor</b> are customized for the particulars of the derived class. </li>
<li>
<b>member functions</b> call corresponding member functions of the underlying Client object. The state of the Client object stored in the derived <code>Object</code> may change accordingly. </li>
<li>
<b>high- and low-level interrogation</b> methods are supported appropriately for the derived class. </li>
</ul>
</dd></dl>
<h1><a class="anchor" id="sec_1_2_2"></a>
1.2.2 Factory</h1>
<dl class="section user"><dt></dt><dd>The client application makes calls to the Factory function in order to instantiate <code>Objects</code> in <code>ObjectHandler</code>. Additional <code>ObjectHandler</code> functions allow the client to delete selected <code>Objects</code>, or to empty the entire repository. </dd></dl>
<dl class="section user"><dt></dt><dd>Class <code>Object</code> supports interfaces for high- and low-level interrogation. For expediency, the return value of function <code>makeObject</code> is the Property vector of the corresponding <code>Object</code>. Rather than interrogate a newly constructed <code>Object</code>, the client application can simply grab the Property vector from the return value of the factory function. For example, in a spreadsheet, a formula array invokes the factory function which instantiates an <code>Object</code> in ObjectHandler, and the return value of the factory function - attributes of the <code>Object</code> - are displayed across a range of cells in the spreadsheet. </dd></dl>
<h1><a class="anchor" id="sec_2"></a>
2 Implementation</h1>
<dl class="section user"><dt></dt><dd>Pseudocode is provided for ObjectHandler and for an example Client application. A complete copy of the latest code can be checked out from the <a href="http://quantlib.org/cvs.shtml">QuantLib CVS</a> (module ObjectHandler), or browsed <a href="http://cvs.sourceforge.net/viewcvs.py/quantlib/ObjectHandler/">on line</a>. </dd></dl>
<h1><a class="anchor" id="sec_2_1"></a>
2.1 ObjectHandler</h1>
<h1><a class="anchor" id="sec_2_1_1"></a>
2.1.1 Object</h1>
<dl class="section user"><dt>object.hpp</dt><dd><div class="fragment"><div class="line"><span class="keyword">typedef</span> boost::shared_ptr&lt;boost::any&gt; any_ptr;</div>
<div class="line"><span class="keyword">typedef</span> Property&lt;string, any_ptr&gt; ObjectProperty;</div>
<div class="line"><span class="keyword">typedef</span> vector&lt;ObjectProperty&gt; Properties;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span>Object {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">   <span class="comment">// constructor, destructor, copy constructor, assignment operator</span></div>
<div class="line">   <span class="comment">// high-level interrogation</span></div>
<div class="line">   <span class="keyword">const</span> Properties &amp;getProperties() <span class="keyword">const</span>;</div>
<div class="line">   <span class="comment">// low-level interrogation</span></div>
<div class="line">   <span class="keyword">virtual</span> boost::shared_ptr&lt;void&gt; getReference() <span class="keyword">const</span> = 0;</div>
<div class="line">   <span class="comment">// future enhancements</span></div>
<div class="line">   <span class="comment">//Coerce();</span></div>
<div class="line">   <span class="comment">//Load();</span></div>
<div class="line">   <span class="comment">//Unload();</span></div>
<div class="line">   <span class="comment">//Serialize();</span></div>
<div class="line">   <span class="comment">//Deserialize();</span></div>
<div class="line">   <span class="comment">//Compress();</span></div>
<div class="line">   <span class="comment">//Uncompress();</span></div>
<div class="line"><span class="keyword">protected</span>:</div>
<div class="line">   Properties properties_;</div>
<div class="line">};</div>
</div><!-- fragment --> </dd></dl>
<dl class="section user"><dt>object.cpp</dt><dd><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="object_8hpp.html">object.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">const</span> Properties &amp;Object::getProperties()<span class="keyword"> const </span>{</div>
<div class="line">   <span class="keywordflow">return</span> properties_;</div>
<div class="line">}</div>
</div><!-- fragment --> </dd></dl>
<h1><a class="anchor" id="sec_2_1_2"></a>
2.1.2 ObjectHandler</h1>
<dl class="section user"><dt>objecthandler.hpp</dt><dd><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="object_8hpp.html">object.hpp</a>&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> boost::shared_ptr&lt;Object&gt; obj_ptr;</div>
<div class="line"><span class="keyword">typedef</span> map&lt;string, obj_ptr&gt; ObjectList;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">class </span><a class="code" href="namespace_object_handler.html">ObjectHandler</a> {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">   <span class="comment">// constructor, destructor</span></div>
<div class="line">   <span class="keywordtype">void</span> storeObject(<span class="keyword">const</span> Handle &amp;handle, <span class="keyword">const</span> obj_ptr &amp;<span class="keywordtype">object</span>);</div>
<div class="line">   obj_ptr retrieveObject(<span class="keyword">const</span> Handle &amp;handle);</div>
<div class="line">   <span class="keywordtype">void</span> deleteObject(<span class="keyword">const</span> std::string &amp;handle);</div>
<div class="line">   <span class="keywordtype">void</span> deleteAllObjects();</div>
<div class="line">   std::vector &lt; std::string &gt;getHandles();</div>
<div class="line">   <span class="keywordtype">void</span> dump(std::ostream&amp;);</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">   ObjectList objectList_;   <span class="comment">// repository of objects</span></div>
<div class="line">};</div>
</div><!-- fragment --> </dd></dl>
<dl class="section user"><dt>objecthandler.cpp</dt><dd><div class="fragment"><div class="line"><span class="preprocessor">#include &quot;objecthandler.hpp&quot;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> ObjectHandler::storeObject(</div>
<div class="line">        <span class="keyword">const</span> Handle &amp;handle,</div>
<div class="line">        <span class="keyword">const</span> obj_ptr &amp;<span class="keywordtype">object</span>) {</div>
<div class="line">    objectList_[handle] = object;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">obj_ptr ObjectHandler::retrieveObject(<span class="keyword">const</span> Handle &amp;handle) {</div>
<div class="line">   ObjectList::const_iterator result = objectList_.find(handle);</div>
<div class="line">   <span class="keywordflow">if</span> (result!=objectList_.end())</div>
<div class="line">      <span class="keywordflow">return</span> result-&gt;second;</div>
<div class="line">   <span class="keywordflow">else</span></div>
<div class="line">      <span class="keywordflow">return</span> obj_ptr();</div>
<div class="line">}</div>
</div><!-- fragment --> </dd></dl>
<h1><a class="anchor" id="sec_2_2"></a>
2.2 Client</h1>
<dl class="section user"><dt></dt><dd>The native client object which is to be stored in ObjectHandler: </dd></dl>
<dl class="section user"><dt>foo.hpp</dt><dd><div class="fragment"><div class="line"><span class="keyword">class </span>Foo {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">   Foo(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;s, <span class="keyword">const</span> <span class="keywordtype">int</span> &amp;i) : s_(s), i_(i) {};</div>
<div class="line">   <span class="keywordtype">void</span> update(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;s, <span class="keyword">const</span> <span class="keywordtype">int</span> &amp;i) {</div>
<div class="line">      s_ = s;</div>
<div class="line">      i_ = i;</div>
<div class="line">   }</div>
<div class="line">   <span class="keywordtype">string</span> s() { <span class="keywordflow">return</span> s_; };</div>
<div class="line">   <span class="keywordtype">int</span> i() { <span class="keywordflow">return</span> i_; };</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">   <span class="keywordtype">string</span> s_;</div>
<div class="line">   <span class="keywordtype">int</span> i_;</div>
<div class="line">};</div>
</div><!-- fragment --> </dd></dl>
<h1><a class="anchor" id="sec_2_2_1"></a>
2.2.1 Object</h1>
<dl class="section user"><dt></dt><dd>Implementation of the <code>Object</code> corresponding to the Foo class: </dd></dl>
<dl class="section user"><dt>objectfoo.hpp</dt><dd><div class="fragment"><div class="line"><span class="keyword">class </span>ObjectFoo : <span class="keyword">public</span> Object {</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">   ObjectFoo(ArgStack &amp;args);</div>
<div class="line">   <span class="keyword">virtual</span> boost::shared_ptr&lt;void&gt; getReference() <span class="keyword">const</span>;</div>
<div class="line">   <span class="keywordtype">void</span> update(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;s, <span class="keyword">const</span> <span class="keywordtype">int</span> &amp;i);</div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">   boost::shared_ptr&lt;Foo&gt; foo_;</div>
<div class="line">};</div>
</div><!-- fragment --> </dd></dl>
<dl class="section user"><dt>objectfoo.cpp</dt><dd><div class="fragment"><div class="line">ObjectFoo::ObjectFoo(ArgStack &amp;args) {</div>
<div class="line">   <span class="comment">// get arguments from argument stack</span></div>
<div class="line">   <span class="keywordtype">int</span> i = Args&lt;int&gt;::popArg(args);</div>
<div class="line">   std::string s = Args&lt;std::string&gt;::popArg(args);</div>
<div class="line">   <span class="comment">// construct foo object</span></div>
<div class="line">   foo_ = boost::shared_ptr&lt;Foo&gt;(<span class="keyword">new</span> Foo(s, i));</div>
<div class="line">   <span class="comment">// populate base class Property vector</span></div>
<div class="line">   any_ptr anyString(<span class="keyword">new</span> boost::any(foo_-&gt;s()));</div>
<div class="line">   any_ptr anyInt(<span class="keyword">new</span> boost::any(foo_-&gt;i()));</div>
<div class="line">   ObjectProperty propString(PROPERTY_STR, anyString);</div>
<div class="line">   ObjectProperty propInt(PROPERTY_INT, anyInt);</div>
<div class="line">   properties_.push_back(propString);</div>
<div class="line">   properties_.push_back(propInt);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// wrapper for underlying member function</span></div>
<div class="line"><span class="keywordtype">void</span> ObjectFoo::update(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp;s, <span class="keyword">const</span> <span class="keywordtype">int</span> &amp;i) {</div>
<div class="line">   foo_-&gt;update(s, i);</div>
<div class="line">   <span class="comment">// update Property vector</span></div>
<div class="line">   *properties_[IDX_STR]() = s;</div>
<div class="line">   *properties_[IDX_INT]() = i;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">boost::shared_ptr&lt;void&gt; ObjectFoo::getReference()<span class="keyword"> const </span>{</div>
<div class="line">   <span class="keywordflow">return</span> boost::static_pointer_cast&lt;void&gt;(foo_);</div>
<div class="line">}</div>
</div><!-- fragment --> </dd></dl>
<h1><a class="anchor" id="sec_2_2_2"></a>
2.2.2 Application</h1>
<dl class="section user"><dt>example.cpp</dt><dd>The syntax of certain calls to ObjectHandler has been simplified with <code>defines</code> as documented in file <a class="el" href="utilities_8hpp.html">utilities.hpp</a>. <div class="fragment"><div class="line"><span class="keywordtype">int</span> main() {</div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        <span class="comment">// specify log file</span></div>
<div class="line">        OH_LOGFILE(<span class="stringliteral">&quot;example.log&quot;</span>);</div>
<div class="line">        <span class="comment">// also direct log messages to stdout</span></div>
<div class="line">        OH_CONSOLE(1);</div>
<div class="line">        <a class="code" href="ohdefines_8hpp.html#a0a9c0ef2dd7303542ef37e3be99844ed">OH_LOG_MESSAGE</a>(<span class="stringliteral">&quot;begin example program&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// construct some objects and store them in the object handler</span></div>
<div class="line">        ArgumentStack foo1Arguments;</div>
<div class="line">        foo1Arguments.push(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;abc&quot;</span>));</div>
<div class="line">        foo1Arguments.push(123);</div>
<div class="line">        Properties foo1Properties = </div>
<div class="line">            OH_MAKE_OBJECT(ObjectFoo, <span class="stringliteral">&quot;foo1&quot;</span>, foo1Arguments);</div>
<div class="line"> </div>
<div class="line">        ArgumentStack foo2Arguments;</div>
<div class="line">        foo2Arguments.push(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;def&quot;</span>));</div>
<div class="line">        foo2Arguments.push(456);</div>
<div class="line">        Properties foo2Properties = </div>
<div class="line">            OH_MAKE_OBJECT(ObjectFoo, <span class="stringliteral">&quot;foo2&quot;</span>, foo2Arguments);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// high level interrogation</span></div>
<div class="line">        <a class="code" href="ohdefines_8hpp.html#a0a9c0ef2dd7303542ef37e3be99844ed">OH_LOG_MESSAGE</a>(<span class="stringliteral">&quot;high level interrogation - after constructor&quot;</span>);</div>
<div class="line">        OH_LOG_OBJECT(<span class="stringliteral">&quot;foo2&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// update an object</span></div>
<div class="line">        FOO_UPDATE(<span class="stringliteral">&quot;foo2&quot;</span>, <span class="stringliteral">&quot;ghi&quot;</span>, 789);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// high level interrogation</span></div>
<div class="line">        <a class="code" href="ohdefines_8hpp.html#a0a9c0ef2dd7303542ef37e3be99844ed">OH_LOG_MESSAGE</a>(<span class="stringliteral">&quot;high level interrogation - after update&quot;</span>);</div>
<div class="line">        OH_LOG_OBJECT(<span class="stringliteral">&quot;foo2&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// low-level interrogation</span></div>
<div class="line">        <a class="code" href="ohdefines_8hpp.html#a0a9c0ef2dd7303542ef37e3be99844ed">OH_LOG_MESSAGE</a>(<span class="stringliteral">&quot;low-level interrogation - after FOO_UPDATE&quot;</span>);</div>
<div class="line">        boost::shared_ptr&lt;ObjectFoo&gt; <span class="keyword">const</span> objectFoo =</div>
<div class="line">            <a class="code" href="ohdefines_8hpp.html#a523ba6d4f8fdf75d75612da8016c8f0d">OH_GET_OBJECT</a>(ObjectFoo, <span class="stringliteral">&quot;foo2&quot;</span>);</div>
<div class="line">        boost::shared_ptr&lt;Foo&gt; foo = </div>
<div class="line">            <a class="code" href="ohdefines_8hpp.html#ae04eab8e5cf42210eddb99403599ae6f">OH_GET_REFERENCE</a>(Foo, objectFoo);</div>
<div class="line">        <a class="code" href="ohdefines_8hpp.html#a0a9c0ef2dd7303542ef37e3be99844ed">OH_LOG_MESSAGE</a>(<span class="stringliteral">&quot;value of property s() of underlying foo = &quot;</span></div>
<div class="line">            + foo-&gt;s());</div>
<div class="line"> </div>
<div class="line">        OH_DELETE_OBJECT(<span class="stringliteral">&quot;foo2&quot;</span>);</div>
<div class="line">        <a class="code" href="ohdefines_8hpp.html#a0a9c0ef2dd7303542ef37e3be99844ed">OH_LOG_MESSAGE</a>(<span class="stringliteral">&quot;log all objects after deleting foo2:&quot;</span>);</div>
<div class="line">        OH_LOG_ALL_OBJECTS();</div>
<div class="line"> </div>
<div class="line">        <a class="code" href="ohdefines_8hpp.html#a0a9c0ef2dd7303542ef37e3be99844ed">OH_LOG_MESSAGE</a>(<span class="stringliteral">&quot;end example program&quot;</span>);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> exception &amp;e) {</div>
<div class="line">        ostringstream s;</div>
<div class="line">        s &lt;&lt; <span class="stringliteral">&quot;Error: &quot;</span> &lt;&lt; e.what();</div>
<div class="line">        <a class="code" href="ohdefines_8hpp.html#a0a9c0ef2dd7303542ef37e3be99844ed">OH_LOG_MESSAGE</a>(s.str(), 1);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    } <span class="keywordflow">catch</span> (...) {</div>
<div class="line">        <a class="code" href="ohdefines_8hpp.html#a0a9c0ef2dd7303542ef37e3be99844ed">OH_LOG_MESSAGE</a>(<span class="stringliteral">&quot;Error&quot;</span>, 1);</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> <div class="center"><img src="images/quep011b.png" alt="" class="inline"/></div> </dd></dl>
<h1><a class="anchor" id="sec_3"></a>
3 Proposed Enhancements</h1>
<h2><a class="anchor" id="sec_3_1"></a>
3.1 ohMethodValue</h2>
<p>Function ohMethodValue would be a generic call to any method of the underlying object e.g. the Excel function might appear as </p><div class="fragment"><div class="line">ohMethodValue(handle, <span class="stringliteral">&quot;methodName&quot;</span>, parameterArray)</div>
</div><!-- fragment --><p> And the corresponding C++ source code would be </p><div class="fragment"><div class="line">returnValue = objectPointer-&gt;getObject().methodName(parameterArray)</div>
</div><!-- fragment --><p> If returnValue is an object the handle is returned.</p>
<p>Implementation would require some kind of message map which would associate strings with member functions. (Unfortunately this is not a straightforward task in C++ compared to many other programming languages.). The code to initialize this container might be generated by srcgen based on metadata.</p>
<h1><a class="anchor" id="sec_4"></a>
4 Feedback</h1>
<dl class="section user"><dt></dt><dd>Feedback on this proposal should be posted to the <a href="#" onclick="location.href='mai'+'lto:'+'qua'+'nt'+'lib'+'-u'+'ser'+'s@'+'lis'+'ts'+'.so'+'ur'+'cef'+'or'+'ge.'+'ne'+'t'; return false;">QuantLib users</a> mailing list. </dd></dl>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<div class="ttc" id="aohdefines_8hpp_html_ae04eab8e5cf42210eddb99403599ae6f"><div class="ttname"><a href="ohdefines_8hpp.html#ae04eab8e5cf42210eddb99403599ae6f">OH_GET_REFERENCE</a></div><div class="ttdeci">#define OH_GET_REFERENCE(NAME, ID, OBJECT_CLASS, LIBRARY_CLASS)</div><div class="ttdoc">Get a shared pointer to the library object referenced by an Object.</div><div class="ttdef"><b>Definition:</b> ohdefines.hpp:99</div></div>
<div class="ttc" id="anamespace_object_handler_html"><div class="ttname"><a href="namespace_object_handler.html">ObjectHandler</a></div><div class="ttdoc">ObjectHandler.</div><div class="ttdef"><b>Definition:</b> coerce.hpp:30</div></div>
<div class="ttc" id="aohdefines_8hpp_html_a0a9c0ef2dd7303542ef37e3be99844ed"><div class="ttname"><a href="ohdefines_8hpp.html#a0a9c0ef2dd7303542ef37e3be99844ed">OH_LOG_MESSAGE</a></div><div class="ttdeci">#define OH_LOG_MESSAGE(message)</div><div class="ttdoc">Log the given message.</div><div class="ttdef"><b>Definition:</b> ohdefines.hpp:123</div></div>
<div class="ttc" id="aohdefines_8hpp_html_a523ba6d4f8fdf75d75612da8016c8f0d"><div class="ttname"><a href="ohdefines_8hpp.html#a523ba6d4f8fdf75d75612da8016c8f0d">OH_GET_OBJECT</a></div><div class="ttdeci">#define OH_GET_OBJECT(NAME, ID, OBJECT_CLASS)</div><div class="ttdoc">Get a boost shared pointer to a class derived from Object.</div><div class="ttdef"><b>Definition:</b> ohdefines.hpp:87</div></div>
<div class="ttc" id="aobject_8hpp_html"><div class="ttname"><a href="object_8hpp.html">object.hpp</a></div><div class="ttdoc">Class Object - Define interface for Objects to be stored in the Repository.</div></div>
<!-- HTML footer for doxygen 1.8.7-->
<!-- start footer part -->
            </div>
            <div class='clearfix'></div>
<div id="footer">SourceForge logo copyright &#169; Open Source Technology Group<br>reposit logo <a href="http://www.reposit.be">copyright &#169; 2015 reposit Ltd Dublin</a><br>all other content <a href="license.html">copyright &#169; 2004-20015 The QuantLib Group</a></div>
        </div>
        <div class='clearfix'></div>
    </div>
    <div class='clearfix'></div>
</body>
</html>
