<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>QuantLib: Repo.cpp</title>
<link rel="stylesheet" href="/styles/fonts.css" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="quantlibextra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname"><a href="https://www.quantlib.org">QuantLib</a>: a free/open-source library for quantitative finance
   <div id="projectnumber">Reference manual - version 1.35</div>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">Repo.cpp</div></div>
</div><!--header-->
<div class="contents">
<p>This example values a fixed-coupon bond repurchase (repo). The repurchase agreement example is set up to use the repo rate to do all discounting (including the underlying bond income). Forward delivery price is also obtained using this repo rate. All this is done by supplying the FixedCouponBondForward constructor with a flat repo YieldTermStructure.</p>
<div class="fragment"><div class="line"><span class="comment">/* -*- mode: c++; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- */</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* a Repo calculation done using the FixedRateBondForward class</span></div>
<div class="line"><span class="comment">   cf. aaBondFwd() repo example at</span></div>
<div class="line"><span class="comment">   http://www.fincad.com/support/developerFunc/mathref/BFWD.htm</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">   This repo is set up to use the repo rate to do all discounting</span></div>
<div class="line"><span class="comment">   (including the underlying bond income). Forward delivery price is</span></div>
<div class="line"><span class="comment">   also obtained using this repo rate. All this is done by supplying</span></div>
<div class="line"><span class="comment">   the FixedRateBondForward constructor with a flat repo</span></div>
<div class="line"><span class="comment">   YieldTermStructure.</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;ql/qldefines.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#if !defined(BOOST_ALL_NO_LIB) &amp;&amp; defined(BOOST_MSVC)</span></div>
<div class="line"><span class="preprocessor">#  include &lt;ql/auto_link.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#include &lt;ql/instruments/bondforward.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ql/instruments/bonds/fixedratebond.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ql/pricingengines/bond/discountingbondengine.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ql/termstructures/yield/flatforward.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ql/time/schedule.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ql/time/calendars/nullcalendar.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ql/time/daycounters/actual360.hpp&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;ql/time/daycounters/thirty360.hpp&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;iomanip&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespacestd.html" title="STL namespace.">std</a>;</div>
<div class="line"><span class="keyword">using namespace </span><a class="code hl_namespace" href="namespace_quant_lib.html">QuantLib</a>;</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span>, <span class="keywordtype">char</span>* []) {</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line"> </div>
<div class="line">        std::cout &lt;&lt; std::endl;</div>
<div class="line"> </div>
<div class="line">        <a id="_a0" name="_a0"></a><a class="code hl_class" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> repoSettlementDate(14,February,2000);;</div>
<div class="line">        <a class="code hl_class" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> repoDeliveryDate(15,August,2000);</div>
<div class="line">        Rate repoRate = 0.05;</div>
<div class="line">        <a id="_a1" name="_a1"></a><a class="code hl_class" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> repoDayCountConvention = <a id="_a2" name="_a2"></a><a class="code hl_class" href="class_quant_lib_1_1_actual360.html" title="Actual/360 day count convention.">Actual360</a>();</div>
<div class="line">        Integer repoSettlementDays = 0;</div>
<div class="line">        Compounding repoCompounding = Simple;</div>
<div class="line">        Frequency repoCompoundFreq = Annual;</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// assume a ten year bond- this is irrelevant</span></div>
<div class="line">        <a class="code hl_class" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> bondIssueDate(15,September,1995);</div>
<div class="line">        <a class="code hl_class" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> bondDatedDate(15,September,1995);</div>
<div class="line">        <a class="code hl_class" href="class_quant_lib_1_1_date.html" title="Concrete date class.">Date</a> bondMaturityDate(15,September,2005);</div>
<div class="line">        Real bondCoupon = 0.08;</div>
<div class="line">        Frequency bondCouponFrequency = Semiannual;</div>
<div class="line">        <span class="comment">// unknown what calendar fincad is using</span></div>
<div class="line">        <a id="_a3" name="_a3"></a><a class="code hl_class" href="class_quant_lib_1_1_calendar.html" title="calendar class">Calendar</a> bondCalendar = <a id="_a4" name="_a4"></a><a class="code hl_class" href="class_quant_lib_1_1_null_calendar.html" title="Calendar for reproducing theoretical calculations.">NullCalendar</a>();</div>
<div class="line">        <a class="code hl_class" href="class_quant_lib_1_1_day_counter.html" title="day counter class">DayCounter</a> bondDayCountConvention = <a id="_a5" name="_a5"></a><a class="code hl_class" href="class_quant_lib_1_1_thirty360.html" title="30/360 day count convention">Thirty360</a>(Thirty360::BondBasis);</div>
<div class="line">        <span class="comment">// unknown what fincad is using. this may affect accrued calculation</span></div>
<div class="line">        Integer bondSettlementDays = 0;</div>
<div class="line">        BusinessDayConvention bondBusinessDayConvention = Unadjusted;</div>
<div class="line">        <a id="_a6" name="_a6"></a><a class="code hl_class" href="class_quant_lib_1_1_bond_1_1_price.html" title="Bond price information.">Bond::Price</a> bondCleanPrice(89.97693786, Bond::Price::Clean);</div>
<div class="line">        Real bondRedemption = 100.0;</div>
<div class="line">        Real faceAmount = 100.0;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        Settings::instance().evaluationDate() = repoSettlementDate;</div>
<div class="line"> </div>
<div class="line">        <a id="_a7" name="_a7"></a><a class="code hl_class" href="class_quant_lib_1_1_relinkable_handle.html" title="Relinkable handle to an observable.">RelinkableHandle&lt;YieldTermStructure&gt;</a> bondCurve;</div>
<div class="line">        bondCurve.<a id="a8" name="a8"></a>linkTo(ext::make_shared&lt;FlatForward&gt;(repoSettlementDate,</div>
<div class="line">                                                       .01, <span class="comment">// dummy rate</span></div>
<div class="line">                                                       bondDayCountConvention,</div>
<div class="line">                                                       Compounded,</div>
<div class="line">                                                       bondCouponFrequency));</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/*</span></div>
<div class="line"><span class="comment">        auto bond = ext::make_shared&lt;FixedRateBond&gt;(faceAmount,</span></div>
<div class="line"><span class="comment">                                         bondIssueDate,</span></div>
<div class="line"><span class="comment">                                         bondDatedDate,</span></div>
<div class="line"><span class="comment">                                         bondMaturityDate,</span></div>
<div class="line"><span class="comment">                                         bondSettlementDays,</span></div>
<div class="line"><span class="comment">                                         std::vector&lt;Rate&gt;(1,bondCoupon),</span></div>
<div class="line"><span class="comment">                                         bondCouponFrequency,</span></div>
<div class="line"><span class="comment">                                         bondCalendar,</span></div>
<div class="line"><span class="comment">                                         bondDayCountConvention,</span></div>
<div class="line"><span class="comment">                                         bondBusinessDayConvention,</span></div>
<div class="line"><span class="comment">                                         bondBusinessDayConvention,</span></div>
<div class="line"><span class="comment">                                         bondRedemption,</span></div>
<div class="line"><span class="comment">                                         bondCurve);</span></div>
<div class="line"><span class="comment">        */</span></div>
<div class="line"> </div>
<div class="line">        <a id="_a9" name="_a9"></a><a class="code hl_class" href="class_quant_lib_1_1_schedule.html" title="Payment schedule.">Schedule</a> bondSchedule(bondDatedDate, bondMaturityDate,</div>
<div class="line">                              <a id="_a10" name="_a10"></a><a class="code hl_class" href="class_quant_lib_1_1_period.html">Period</a>(bondCouponFrequency),</div>
<div class="line">                              bondCalendar,bondBusinessDayConvention,</div>
<div class="line">                              bondBusinessDayConvention,</div>
<div class="line">                              DateGeneration::Backward,<span class="keyword">false</span>);</div>
<div class="line">        <span class="keyword">auto</span> bond = ext::make_shared&lt;FixedRateBond&gt;(bondSettlementDays,</div>
<div class="line">                                         faceAmount,</div>
<div class="line">                                         bondSchedule,</div>
<div class="line">                                         std::vector&lt;Rate&gt;(1,bondCoupon),</div>
<div class="line">                                         bondDayCountConvention,</div>
<div class="line">                                         bondBusinessDayConvention,</div>
<div class="line">                                         bondRedemption,</div>
<div class="line">                                         bondIssueDate);</div>
<div class="line">        bond-&gt;setPricingEngine(ext::make_shared&lt;DiscountingBondEngine&gt;(bondCurve));</div>
<div class="line"> </div>
<div class="line">        bondCurve.linkTo(ext::make_shared&lt;FlatForward&gt;(repoSettlementDate,</div>
<div class="line">                                   bond-&gt;yield(bondCleanPrice,</div>
<div class="line">                                               bondDayCountConvention,</div>
<div class="line">                                               Compounded,</div>
<div class="line">                                               bondCouponFrequency),</div>
<div class="line">                                   bondDayCountConvention,</div>
<div class="line">                                   Compounded,</div>
<div class="line">                                   bondCouponFrequency));</div>
<div class="line"> </div>
<div class="line">        Position::Type fwdType = Position::Long;</div>
<div class="line">        <span class="keywordtype">double</span> dummyStrike = 91.5745;</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_class" href="class_quant_lib_1_1_relinkable_handle.html" title="Relinkable handle to an observable.">RelinkableHandle&lt;YieldTermStructure&gt;</a> repoCurve;</div>
<div class="line">        repoCurve.linkTo(ext::make_shared&lt;FlatForward&gt;(repoSettlementDate,</div>
<div class="line">                                                       repoRate,</div>
<div class="line">                                                       repoDayCountConvention,</div>
<div class="line">                                                       repoCompounding,</div>
<div class="line">                                                       repoCompoundFreq));</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <a id="_a11" name="_a11"></a><a class="code hl_class" href="class_quant_lib_1_1_bond_forward.html" title="Forward contract on a bond">BondForward</a> bondFwd(repoSettlementDate, repoDeliveryDate, fwdType, dummyStrike,</div>
<div class="line">                            repoSettlementDays, repoDayCountConvention, bondCalendar,</div>
<div class="line">                            bondBusinessDayConvention, bond, repoCurve, repoCurve);</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Underlying bond clean price: &quot;</span></div>
<div class="line">             &lt;&lt; bond-&gt;cleanPrice()</div>
<div class="line">             &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Underlying bond dirty price: &quot;</span></div>
<div class="line">             &lt;&lt; bond-&gt;dirtyPrice()</div>
<div class="line">             &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Underlying bond accrued at settlement: &quot;</span></div>
<div class="line">             &lt;&lt; bond-&gt;accruedAmount(repoSettlementDate)</div>
<div class="line">             &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Underlying bond accrued at delivery:   &quot;</span></div>
<div class="line">             &lt;&lt; bond-&gt;accruedAmount(repoDeliveryDate)</div>
<div class="line">             &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Underlying bond spot income: &quot;</span></div>
<div class="line">             &lt;&lt; bondFwd.<a id="a12" name="a12"></a><a class="code hl_function" href="class_quant_lib_1_1_bond_forward.html#aaec6fd4368ca7c5ed7bd52444ff441c5" title="NPV of bond coupons discounted using incomeDiscountCurve.">spotIncome</a>(repoCurve)</div>
<div class="line">             &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Underlying bond fwd income:  &quot;</span></div>
<div class="line">             &lt;&lt; bondFwd.<a class="code hl_function" href="class_quant_lib_1_1_bond_forward.html#aaec6fd4368ca7c5ed7bd52444ff441c5" title="NPV of bond coupons discounted using incomeDiscountCurve.">spotIncome</a>(repoCurve)/</div>
<div class="line">                repoCurve-&gt;discount(repoDeliveryDate)</div>
<div class="line">             &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Repo strike: &quot;</span></div>
<div class="line">             &lt;&lt; dummyStrike</div>
<div class="line">             &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Repo NPV:    &quot;</span></div>
<div class="line">             &lt;&lt; bondFwd.<a id="a13" name="a13"></a><a class="code hl_function" href="class_quant_lib_1_1_instrument.html#a4f791921f063f3ea19bd6efa9ceb4892" title="returns the net present value of the instrument.">NPV</a>()</div>
<div class="line">             &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Repo clean forward price: &quot;</span></div>
<div class="line">             &lt;&lt; bondFwd.<a id="a14" name="a14"></a><a class="code hl_function" href="class_quant_lib_1_1_bond_forward.html#a8212bccdc064fa30d02fb17001be2fd9" title="(dirty) forward bond price minus accrued on bond at delivery">cleanForwardPrice</a>()</div>
<div class="line">             &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Repo dirty forward price: &quot;</span></div>
<div class="line">             &lt;&lt; bondFwd.<a id="a15" name="a15"></a><a class="code hl_function" href="class_quant_lib_1_1_bond_forward.html#a665b769ab708840b202708bcda610fa6" title="(dirty) forward bond price">forwardPrice</a>()</div>
<div class="line">             &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Repo implied yield: &quot;</span></div>
<div class="line">             &lt;&lt; bondFwd.<a id="a16" name="a16"></a><a class="code hl_function" href="class_quant_lib_1_1_forward.html#a639e594493d01a309391da84b2b48f7e">impliedYield</a>(bond-&gt;dirtyPrice(),</div>
<div class="line">                                     dummyStrike,</div>
<div class="line">                                     repoSettlementDate,</div>
<div class="line">                                     repoCompounding,</div>
<div class="line">                                     repoDayCountConvention)</div>
<div class="line">             &lt;&lt; endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Market repo rate:   &quot;</span></div>
<div class="line">             &lt;&lt; repoCurve-&gt;zeroRate(repoDeliveryDate,</div>
<div class="line">                                    repoDayCountConvention,</div>
<div class="line">                                    repoCompounding,</div>
<div class="line">                                    repoCompoundFreq)</div>
<div class="line">             &lt;&lt; endl</div>
<div class="line">             &lt;&lt; endl;</div>
<div class="line"> </div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Compare with example given at \n&quot;</span></div>
<div class="line">             &lt;&lt; <span class="stringliteral">&quot;http://www.fincad.com/support/developerFunc/mathref/BFWD.htm&quot;</span></div>
<div class="line">             &lt;&lt;  endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Clean forward price = 88.2408&quot;</span></div>
<div class="line">             &lt;&lt;  endl</div>
<div class="line">             &lt;&lt;  endl;</div>
<div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;In that example, it is unknown what bond calendar they are\n&quot;</span></div>
<div class="line">             &lt;&lt; <span class="stringliteral">&quot;using, as well as settlement Days. For that reason, I have\n&quot;</span></div>
<div class="line">             &lt;&lt; <span class="stringliteral">&quot;made the simplest possible assumptions here: NullCalendar\n&quot;</span></div>
<div class="line">             &lt;&lt; <span class="stringliteral">&quot;and 0 settlement days.&quot;</span></div>
<div class="line">             &lt;&lt; endl;</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line"> </div>
<div class="line">    } <span class="keywordflow">catch</span> (exception&amp; e) {</div>
<div class="line">        cerr &lt;&lt; e.what() &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    } <span class="keywordflow">catch</span> (...) {</div>
<div class="line">        cerr &lt;&lt; <span class="stringliteral">&quot;unknown error&quot;</span> &lt;&lt; endl;</div>
<div class="line">        <span class="keywordflow">return</span> 1;</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="line"> </div>
</div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by <a href="http://www.doxygen.org/index.html">Doxygen</a>
1.11.0
</small></address>
</body>
</html>
